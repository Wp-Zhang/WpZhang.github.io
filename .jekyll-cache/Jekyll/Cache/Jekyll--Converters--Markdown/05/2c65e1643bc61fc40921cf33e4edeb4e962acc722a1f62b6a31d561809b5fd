I"Ü}<h2 id="åŸºæœ¬ç†è®º">åŸºæœ¬ç†è®º</h2>

<ul>
  <li>
    <p><strong>ä¼˜ç‚¹</strong>ï¼šè®¡ç®—ä»£ä»·ä¸é«˜ï¼Œæ˜“äºç†è§£å’Œå®ç°</p>
  </li>
  <li>
    <p><strong>ç¼ºç‚¹</strong>ï¼šå®¹æ˜“æ¬ æ‹Ÿåˆï¼Œåˆ†ç±»ç²¾åº¦å¯èƒ½ä¸é«˜</p>
  </li>
  <li>
    <p><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šæ•°å€¼å‹å’Œæ ‡ç§°å‹æ•°æ®</p>
  </li>
</ul>

<p>é¢„æµ‹ç»“æœå¾—å‡ºåè¦å°†å…¶è¿›è¡Œåˆ†ç±»ã€‚åŸå§‹çš„å‡½æ•°æœ‰è·ƒé˜¶å‡½æ•°ï¼ˆå³å½“å€¼å°äºæŸä¸ªä¸´ç•Œç‚¹æ—¶å¾—0ï¼Œå¤§äºæ—¶å¾—1ï¼‰ï¼Œä½†è¿™æ ·çš„ç¬é—´è·³è·ƒæœ‰äº›æ—¶å€™ä¸ä¾¿äºå¤„ç†ï¼Œäºæ˜¯è¿™é‡Œä½¿ç”¨å¦ä¸€ä¸ªå‡½æ•°â€”â€”sigmoidå‡½æ•°</p>

<p>sigmoidå‡½æ•°ï¼š<img src="http://latex.codecogs.com/gif.latex?%5Csigma%20%28z%29%20%3D%20%5Cfrac%7B1%7D%7B1&plus;e%5E%7B-z%7D%7D" />ï¼Œä½œå›¾å¯çŸ¥sigmoidå‡½æ•°çš„å›¾åƒæ˜¯ä¸€æ¡å¹³æ»‘çš„æ›²çº¿ï¼Œè¿™è®©ä¹‹åæ±‚æ¢¯åº¦çš„æ­¥éª¤å˜å¾—ååˆ†å®¹æ˜“ä¸”åˆ†ç±»æ•ˆæœä¹Ÿè¦å¥½å¾ˆå¤šã€‚</p>

<p>sigmoidå‡½æ•°çš„è¾“å…¥ä¸ºzï¼Œæœ€ç®€å•çš„æƒ…å†µä¸‹<img src="http://latex.codecogs.com/gif.latex?z%20%3D%20ax" />ï¼Œä½†æ˜¯å½“æœ‰å¤šä¸ªç‰¹å¾æ—¶ï¼Œå…¬å¼å˜ä¸º<img src="http://latex.codecogs.com/gif.latex?z%20%3D%20w_1x_1%20&plus;%20w_2x_2%20&plus;%20...%20&plus;%20w_nx_n" />ï¼Œä¸ºäº†ä¾¿äºæ•°æ®çš„æ“ä½œï¼Œå¼•å…¥çŸ©é˜µè¿ç®—ï¼šä»¤<img src="http://latex.codecogs.com/gif.latex?w%20%3D%20%5Cbegin%7Bbmatrix%7Dw_1%20%26%20w_2%20%26%20...%20%26%20w_n%5Cend%7Bbmatrix%7D" />ï¼Œåˆ™æœ‰<img src="http://latex.codecogs.com/gif.latex?z%20%3D%20w%5ETx" /></p>

<h3 id="æ¢¯åº¦ä¸Šå‡ä¸‹é™æ³•">æ¢¯åº¦ä¸Šå‡/ä¸‹é™æ³•</h3>

<p>å‡½æ•°fåœ¨ç‚¹(x, y)çš„æ¢¯åº¦å¯ä»¥è¡¨ç¤ºä¸ºï¼š<img src="http://latex.codecogs.com/gif.latex?%5Ctriangledown%20f%28x%2Cy%29%20%3D%20%5Cbegin%7Bpmatrix%7D%5Cfrac%7B%5Cpartial%20f%28x%2Cy%29%7D%7B%5Cpartial%20x%7D%5C%5C%5Cfrac%7B%5Cpartial%20f%28x%2Cy%29%7D%7B%5Cpartial%20y%7D%20%5Cend%7Bpmatrix%7D" />ï¼Œå³f(x,y)åˆ†åˆ«å¯¹xï¼Œyçš„åå¯¼</p>

<p>äºæ˜¯å¯ä»¥å¾—å‡ºæ¢¯åº¦ä¸Šå‡/ä¸‹é™æ³•ä¸­wçš„è¿­ä»£å…¬å¼ï¼š<img src="http://latex.codecogs.com/gif.latex?w%20%3D%20w%20&plus;%20%5Calpha%20%5Ctriangledown_w%20f%28w%29" />(æ¢¯åº¦ä¸Šå‡å‘ä¸º+ï¼Œæ¢¯åº¦ä¸‹é™æ³•ä¸º-ï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯å‰è€…æ±‚æœ€å¤§å€¼ï¼Œåè€…æ±‚æœ€å°å€¼)ï¼Œå…¶ä¸­<img src="http://latex.codecogs.com/gif.latex?%5Calpha" />ä¸ºå­¦ä¹ ç‡ï¼Œå…¶å€¼è¶Šå¤§ï¼Œå­¦ä¹ é€Ÿç‡è¶Šå¿«ï¼Œä½†ä¹Ÿè¶Šå®¹æ˜“å¯¼è‡´è¿­ä»£ä¸æ”¶æ•›ã€‚</p>

<p>è®¾ç½®å¥½å­¦ä¹ ç‡å’Œåˆå§‹çš„wçŸ©é˜µä»¥åŠæœ€å¤§çš„è¿­ä»£æ¬¡æ•°åï¼Œå°±å¯ä»¥å¼€å§‹è¿­ä»£ã€‚å½“åˆ°è¾¾æœ€å¤§è¿­ä»£æ¬¡æ•°æˆ–æŸä¸ªåœæ­¢æ¡ä»¶æ—¶è¿­ä»£åœæ­¢ï¼Œæ­¤æ—¶çš„wå°±æ˜¯ç»è¿‡å­¦ä¹ åçš„å‚æ•°çŸ©é˜µã€‚</p>

<h2 id="è®­ç»ƒç®—æ³•ä½¿ç”¨æ¢¯åº¦ä¸Šå‡æ‰¾åˆ°æœ€ä½³å‚æ•°">è®­ç»ƒç®—æ³•ï¼šä½¿ç”¨æ¢¯åº¦ä¸Šå‡æ‰¾åˆ°æœ€ä½³å‚æ•°</h2>

<h3 id="è½½å…¥æ•°æ®">è½½å…¥æ•°æ®</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">loadData</span><span class="p">():</span>

    <span class="s">"""

    ä»ç›®å½•è¯»å–æµ‹è¯•æ•°æ®ï¼Œå°†æ•°æ®åˆ‡åˆ†ä¸ºæ•°æ®çŸ©é˜µå’Œæ ‡ç­¾çŸ©é˜µï¼Œå¹¶ä»¥np.arrayçš„æ ¼å¼è¿”å›

    """</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'data/testSet.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

        <span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">dataMat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">labelMat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'int'</span><span class="p">)</span>

    

    <span class="k">return</span> <span class="n">dataMat</span><span class="p">,</span> <span class="n">labelMat</span>

    

</code></pre></div></div>

<h3 id="æ¢¯åº¦ä¸Šå‡ç®—æ³•">æ¢¯åº¦ä¸Šå‡ç®—æ³•</h3>

<h4 id="sigmoidå‡½æ•°">sigmoidå‡½æ•°</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">inX</span><span class="p">):</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">inX</span><span class="p">))</span>

</code></pre></div></div>

<h4 id="æ¢¯åº¦ä¸Šå‡ç®—æ³•-1">æ¢¯åº¦ä¸Šå‡ç®—æ³•</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">gradAscent</span><span class="p">(</span><span class="n">dataMat</span><span class="p">,</span> <span class="n">classLabels</span><span class="p">):</span>

    <span class="n">dataMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">dataMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">dataMatrix</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dataMat</span>

    <span class="n">classLabels</span> <span class="o">=</span> <span class="n">classLabels</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">classLabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># å°†æ ‡ç­¾æ•°æ®çŸ©é˜µè½¬ç½®
</span>
    

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># å­¦ä¹ ç‡
</span>
    <span class="n">maxCycles</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># æœ€å¤§è¿­ä»£æ¬¡æ•°
</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">dataMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># åˆå§‹åŒ–ç³»æ•°çŸ©é˜µ
</span>
    <span class="c1"># å¼€å§‹è¿­ä»£
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxCycles</span><span class="p">):</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">@</span><span class="n">weights</span><span class="p">)</span>

        <span class="n">error</span> <span class="o">=</span> <span class="n">classLabels</span> <span class="o">-</span> <span class="n">z</span>  <span class="c1"># è®¡ç®—é”™è¯¯é‡
</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">dataMatrix</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">error</span>  <span class="c1"># æ›´æ–°ç³»æ•°
</span>


    <span class="k">return</span> <span class="n">weights</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">dataMat</span><span class="p">,</span> <span class="n">labelMat</span> <span class="o">=</span> <span class="n">loadData</span><span class="p">()</span>

<span class="n">gradAscent</span><span class="p">(</span><span class="n">dataMat</span><span class="p">,</span> <span class="n">labelMat</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="åˆ†ææ•°æ®ç”»å‡ºå†³ç­–è¾¹ç•Œ">åˆ†ææ•°æ®ï¼šç”»å‡ºå†³ç­–è¾¹ç•Œ</h2>

<h3 id="ç”»å‡ºæ‹Ÿåˆç›´çº¿">ç”»å‡ºæ‹Ÿåˆç›´çº¿</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">plotBestFit</span><span class="p">(</span><span class="n">weight</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

    

    <span class="n">dataMat</span><span class="p">,</span> <span class="n">labelMat</span> <span class="o">=</span> <span class="n">loadData</span><span class="p">()</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">y2</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

        <span class="k">if</span> <span class="n">labelMat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">x1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">y1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">x2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">y2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataMat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'red'</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>

    

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">weight</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">weight</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">plotBestFit</span><span class="p">(</span><span class="n">gradAscent</span><span class="p">(</span><span class="n">dataMat</span><span class="p">,</span> <span class="n">labelMat</span><span class="p">))</span>

</code></pre></div></div>

<p><img src="/img/in-post/old/output_20_0_20190328222420960806.png" alt="" /></p>

<h2 id="è®­ç»ƒç®—æ³•éšæœºæ¢¯åº¦ä¸Šå‡">è®­ç»ƒç®—æ³•ï¼šéšæœºæ¢¯åº¦ä¸Šå‡?</h2>

<p>ä¹‹å‰çš„æ¢¯åº¦ä¸Šå‡ç®—æ³•æ¯æ¬¡æ›´æ–°ç³»æ•°éƒ½è¦éå†ä¸€æ¬¡æ•°æ®é›†ï¼Œå½“æ•°æ®é›†å¾ˆåºå¤§æ—¶å°†æä¸ºè€—æ—¶ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">stocGradAscent</span><span class="p">(</span><span class="n">dataMat</span><span class="p">,</span> <span class="n">classLabels</span><span class="p">):</span>

    <span class="n">dataMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">dataMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dataMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">dataMatrix</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dataMat</span>

    <span class="n">classLabels</span> <span class="o">=</span> <span class="n">classLabels</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">classLabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># å°†æ ‡ç­¾æ•°æ®çŸ©é˜µè½¬ç½®
</span>
    

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># å­¦ä¹ ç‡
</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># åˆå§‹åŒ–ç³»æ•°çŸ©é˜µ
</span>
    <span class="c1"># å¼€å§‹è¿­ä»£
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">@</span><span class="n">weights</span><span class="p">))</span>

        <span class="n">error</span> <span class="o">=</span> <span class="n">classLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span>  <span class="c1"># è®¡ç®—é”™è¯¯é‡
</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">error</span> <span class="o">*</span> <span class="n">dataMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># æ›´æ–°ç³»æ•°
</span>
    <span class="k">return</span> <span class="n">weights</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">plotBestFit</span><span class="p">(</span><span class="n">stocGradAscent</span><span class="p">(</span><span class="n">dataMat</span><span class="p">,</span> <span class="n">labelMat</span><span class="p">))</span>

</code></pre></div></div>

<p><img src="/img/in-post/old/output_24_0_20190328222348320357.png" alt="" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">stocGradAscent1</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">,</span> <span class="n">classLabels</span><span class="p">,</span> <span class="n">numIter</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>

    <span class="n">classLabels</span> <span class="o">=</span> <span class="n">classLabels</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">classLabels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># å°†æ ‡ç­¾æ•°æ®çŸ©é˜µè½¬ç½®
</span>
    

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># å­¦ä¹ ç‡
</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># åˆå§‹åŒ–ç³»æ•°çŸ©é˜µ
</span>
    <span class="c1"># å¼€å§‹è¿­ä»£
</span>
    <span class="kn">import</span> <span class="nn">random</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numIter</span><span class="p">):</span>

        <span class="n">randIndex</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">randIndex</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>

            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.01</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">randIndex</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">z</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">dataMatrix</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="n">weights</span><span class="p">))</span>

            <span class="n">error</span> <span class="o">=</span> <span class="n">classLabels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span>  <span class="c1"># è®¡ç®—é”™è¯¯é‡
</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">error</span> <span class="o">*</span> <span class="n">dataMatrix</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># æ›´æ–°ç³»æ•°
</span>
    <span class="k">return</span> <span class="n">weights</span>

</code></pre></div></div>

<h2 id="ç¤ºä¾‹ä»ç–æ°”ç—…ç—‡é¢„æµ‹ç—…é©¬çš„æ­»äº¡ç‡">ç¤ºä¾‹ï¼šä»ç–æ°”ç—…ç—‡é¢„æµ‹ç—…é©¬çš„æ­»äº¡ç‡</h2>

<h3 id="å‡†å¤‡æ•°æ®å¤„ç†ç¼ºå¤±å€¼">å‡†å¤‡æ•°æ®ï¼šå¤„ç†ç¼ºå¤±å€¼</h3>

<p>ç”±äºæœ‰ç¼ºå¤±å€¼æ—¶NumPyæ•°ç»„æ— æ³•è¿›è¡Œè¿ç®—ï¼ŒåŒæ—¶ä¹Ÿä¼šå½±å“åˆ†ç±»ï¼Œäºæ˜¯éœ€è¦å¯¹å…¶è¿›è¡Œå¡«è¡¥ã€‚å¸¸ç”¨çš„ç¼ºå¤±å€¼å¡«è¡¥æ–¹æ³•æœ‰å¤šç§ï¼Œä½†æ˜¯è¿™é‡Œç”¨0å¡«è¡¥ã€‚å› ä¸ºæ ¹æ®ç³»æ•°çš„è¿­ä»£å…¬å¼å¯ä»¥çŸ¥é“å½“ç³»æ•°ä¸º0æ—¶ï¼Œè¯¥ç³»æ•°å°†åœ¨è·Œå€’è¿‡ç¨‹ä¸­ä¿æŒä¸å˜ï¼Œå³ä¸ä¼šå¯¹å‰æœŸæ›´æ–°çš„ç³»æ•°äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</p>

<h3 id="æµ‹è¯•ç®—æ³•ç”¨logisticå›å½’è¿›è¡Œåˆ†ç±»">æµ‹è¯•ç®—æ³•ï¼šç”¨Logisticå›å½’è¿›è¡Œåˆ†ç±»</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">classifyVector</span><span class="p">(</span><span class="n">inX</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>

    <span class="n">prob</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">inX</span><span class="o">@</span><span class="n">weights</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">0</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">colicTest</span><span class="p">():</span>

    <span class="c1"># å‡†å¤‡æ•°æ®
</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'data/horseColicTest.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">strTrain</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strTrain</span><span class="p">):</span>

        <span class="n">strTrain</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

    <span class="n">trainingData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strTrain</span><span class="p">)</span>

    

    <span class="c1"># è®­ç»ƒåˆ†ç±»å™¨
</span>
    <span class="n">trainSet</span> <span class="o">=</span> <span class="n">trainingData</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># è®­ç»ƒæ•°æ®
</span>
    <span class="n">trainLabel</span> <span class="o">=</span> <span class="n">trainingData</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># è®­ç»ƒæ ‡ç­¾
</span>
    <span class="n">trainWeights</span> <span class="o">=</span> <span class="n">stocGradAscent1</span><span class="p">(</span><span class="n">trainSet</span><span class="p">,</span> <span class="n">trainLabel</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

    

    <span class="c1"># æµ‹è¯•åˆ†ç±»å™¨
</span>
    <span class="n">errorCount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'data/horseColicTraining.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">testData</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">numTestVec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">testData</span><span class="p">:</span>

        <span class="n">currLine</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">)</span>

        <span class="n">currLine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currLine</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'float'</span><span class="p">)</span>

        <span class="c1">#print(trainWeights.shape)
</span>
        <span class="c1">#print(currLine.shape)
</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">classifyVector</span><span class="p">(</span><span class="n">currLine</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">trainWeights</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">currLine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>

            <span class="n">errorCount</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">errorRate</span> <span class="o">=</span> <span class="n">errorCount</span> <span class="o">/</span> <span class="n">numTestVec</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"the error rate of this test is: </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> <span class="n">errorRate</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errorRate</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">multiTest</span><span class="p">():</span>

    <span class="n">numTests</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">errorSum</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numTests</span><span class="p">):</span>

        <span class="n">errorSum</span> <span class="o">+=</span> <span class="n">colicTest</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"after </span><span class="si">%</span><span class="s">d iterations the average error rate is: </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> <span class="p">(</span><span class="n">numTests</span><span class="p">,</span> <span class="n">errorSum</span><span class="o">/</span><span class="n">numTests</span><span class="p">))</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">multiTest</span><span class="p">()</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the error rate of this test is: 0.314381

the error rate of this test is: 0.334448

the error rate of this test is: 0.371237

the error rate of this test is: 0.327759

the error rate of this test is: 0.314381

the error rate of this test is: 0.317726

the error rate of this test is: 0.374582

the error rate of this test is: 0.364548

the error rate of this test is: 0.311037

the error rate of this test is: 0.324415

after 10 iterations the average error rate is: 0.335452
</code></pre></div></div>

<p>multiTestå‡½æ•°è¿è¡Œäº†10æ¬¡åˆ†ç±»å‡½æ•°ï¼Œè®¡ç®—äº†é”™è¯¯ç‡çš„å¹³å‡å€¼ã€‚</p>
:ET