I"*³<h2 id="ç†è®ºéƒ¨åˆ†">ç†è®ºéƒ¨åˆ†</h2>

<h3 id="åŸºäºè´å¶æ–¯å†³ç­–ç†è®ºçš„åˆ†ç±»æ–¹æ³•">åŸºäºè´å¶æ–¯å†³ç­–ç†è®ºçš„åˆ†ç±»æ–¹æ³•</h3>

<p><strong>ä¼˜ç‚¹</strong>ï¼šåœ¨æ•°æ®é‡è¾ƒå°‘çš„æƒ…å†µä¸‹ä»ç„¶æœ‰æ•ˆï¼Œå¯ä»¥å¤„ç†å¤šç±»åˆ«é—®é¢˜</p>

<p><strong>ç¼ºç‚¹</strong>ï¼šå¯¹äºè¾“å…¥æ•°æ®çš„å‡†å¤‡æ–¹å¼è¾ƒä¸ºæ•æ„Ÿ</p>

<p><strong>é€‚ç”¨æ•°æ®ç±»å‹</strong>ï¼šæ ‡ç§°å‹æ•°æ®</p>

<h3 id="æ¦‚ç‡å…¬å¼">æ¦‚ç‡å…¬å¼</h3>

<p>æ¡ä»¶æ¦‚ç‡å…¬å¼ï¼š<img src="http://latex.codecogs.com/gif.latex?p%28A%7CB%29%20%3D%20%5Cfrac%7Bp%28AB%29%7D%7Bp%28B%29%7D" />ï¼Œè®¡ç®—äº‹ä»¶Bå‘ç”Ÿçš„å‰æä¸‹äº‹ä»¶Aå‘ç”Ÿçš„æ¦‚ç‡</p>

<p>è´å¶æ–¯å‡†åˆ™ï¼š<img src="http://latex.codecogs.com/gif.latex?p%28c%7Cx%29%20%3D%20%5Cfrac%7Bp%28x%7Cc%29%20p%28c%29%7D%7Bp%28x%29%7D" />ï¼Œåœ¨å·²çŸ¥<img src="http://latex.codecogs.com/gif.latex?p%28x%7Cc%29" />çš„æƒ…å†µä¸‹è®¡ç®—<img src="http://latex.codecogs.com/gif.latex?p%28c%7Cx%29" /></p>

<h3 id="ä½¿ç”¨æ¡ä»¶æ¦‚ç‡è¿›è¡Œåˆ†ç±»">ä½¿ç”¨æ¡ä»¶æ¦‚ç‡è¿›è¡Œåˆ†ç±»</h3>

<p>å‡è®¾è¦åˆ†ç±»çš„ç‚¹æ˜¯(x, y)ï¼Œç°æœ‰ä¸¤ä¸ªåˆ†ç±»<img src="http://latex.codecogs.com/gif.latex?c_1" />å’Œ<img src="http://latex.codecogs.com/gif.latex?c_2" />ï¼Œé€šè¿‡æ¡ä»¶æ¦‚ç‡å¯¹è¿™ä¸ªç‚¹è¿›è¡Œåˆ†ç±»å³æ¯”è¾ƒè¯¥ç‚¹å¯èƒ½ä¸ºæ¯ä¸€ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œå‡ºç°æ¦‚ç‡æœ€å¤§çš„å³ä¸ºè¯¥ç‚¹æ‰€å±åˆ†ç±»ï¼Œå³æ¯”è¾ƒ<img src="http://latex.codecogs.com/gif.latex?p%28c_1%7Cx%2C%20y%29" />å’Œ<img src="http://latex.codecogs.com/gif.latex?p%28c_2%7Cx%2C%20y%29" />ã€‚</p>

<p>å¯ä»¥é€šè¿‡è´å¶æ–¯å‡†åˆ™è®¡ç®—ï¼š<img src="http://latex.codecogs.com/gif.latex?p%28c_i%7Cx%2Cy%29%20%3D%20%5Cfrac%7Bp%28x%2Cy%7Cc_i%29%20p%28c_i%29%7D%7Bp%28x%2Cy%29%7D" /></p>

<p>æœ€ç»ˆè‹¥<img src="http://latex.codecogs.com/gif.latex?p%28c_1%7Cx%2Cy%29%20%3E%20p%28c_2%7Cx%2Cy%29" />ï¼Œåˆ™(x,y)å±äº<img src="http://latex.codecogs.com/gif.latex?c_1" />, è‹¥<img src="http://latex.codecogs.com/gif.latex?p%28c_1%7Cx%2Cy%29%20%3C%20p%28c_2%7Cx%2Cy%29" />ï¼Œ(x,y)å±äº<img src="http://latex.codecogs.com/gif.latex?c_2" /></p>

<h3 id="ä½¿ç”¨æœ´ç´ è´å¶æ–¯è¿›è¡Œæ–‡æ¡£åˆ†ç±»">ä½¿ç”¨æœ´ç´ è´å¶æ–¯è¿›è¡Œæ–‡æ¡£åˆ†ç±»</h3>

<p>æœ´ç´ è´å¶æ–¯ä¹‹æ‰€ä»¥ç§°ä¸ºâ€œæœ´ç´ â€ï¼Œæ˜¯å› ä¸ºå…¶å‡è®¾æ‰€æœ‰ç‰¹å¾ä¹‹é—´åœ¨ç»Ÿè®¡å­¦ä¸Šæ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼ˆå³æ¯ä¸ªç‰¹å¾çš„å‡ºç°ä¸å…¶ä»–ç‰¹å¾æ— å…³ï¼‰ã€‚è™½ç„¶è¿™ä¸ªå‡è®¾åœ¨ç°å®ç”Ÿæ´»ä¸­çš„å¤§å¤šæ•°æƒ…å†µä¸­çœ‹èµ·æ¥éƒ½ä¸æ˜¯å¾ˆåˆé€‚ï¼Œä½†æ˜¯æœ´ç´ è´å¶æ–¯åœ¨å®é™…ä¸­çš„è¡¨ç°å´å¾ˆå¥½ã€‚</p>

<h2 id="ä½¿ç”¨pythonè¿›è¡Œä¾®è¾±æ€§æ–‡æœ¬åˆ†ç±»">ä½¿ç”¨Pythonè¿›è¡Œä¾®è¾±æ€§æ–‡æœ¬åˆ†ç±»</h2>

<h3 id="å‡†å¤‡æ•°æ®ä»æ–‡æ¡£ä¸­æ„å»ºè¯å‘é‡è¯é›†æ¨¡å‹">å‡†å¤‡æ•°æ®ï¼šä»æ–‡æ¡£ä¸­æ„å»ºè¯å‘é‡â€“è¯é›†æ¨¡å‹</h3>

<p>æ–‡æœ¬åˆ†ç±»è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç‰¹å¾æ¥è‡ªäº<strong>è¯æ¡</strong>ï¼ˆå­—ç¬¦çš„ä»»æ„ç»„åˆï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å§æ–‡æœ¬çœ‹æˆå•è¯å‘é‡æˆ–è¯æ¡å‘é‡ï¼ˆæŠŠå¥å­è½¬æ¢ä¸ºå‘é‡ï¼‰ã€‚</p>

<p>å…·ä½“æ­¥éª¤ä¸ºï¼š</p>

<ol>
  <li>
    <p>è€ƒè™‘å‡ºç°åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­çš„æ‰€æœ‰å•è¯ï¼Œå°†ä¸€äº›è¯çº³å…¥è¯æ±‡è¡¨/è¯æ±‡é›†åˆï¼›</p>
  </li>
  <li>
    <p>å°†æ¯ä¸€ç¯‡æ–‡ç« è½¬æ¢ä¸ºè¯æ±‡è¡¨ä¸Šçš„å‘é‡</p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">loadDataSet</span><span class="p">():</span>

    <span class="n">postingList</span><span class="o">=</span><span class="p">[[</span><span class="s">'my'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'has'</span><span class="p">,</span> <span class="s">'flea'</span><span class="p">,</span> <span class="s">'problems'</span><span class="p">,</span> <span class="s">'help'</span><span class="p">,</span> <span class="s">'please'</span><span class="p">],</span>

                 <span class="p">[</span><span class="s">'maybe'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">,</span> <span class="s">'take'</span><span class="p">,</span> <span class="s">'him'</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'park'</span><span class="p">,</span> <span class="s">'stupid'</span><span class="p">],</span>

                 <span class="p">[</span><span class="s">'my'</span><span class="p">,</span> <span class="s">'dalmation'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">,</span> <span class="s">'so'</span><span class="p">,</span> <span class="s">'cute'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">,</span> <span class="s">'love'</span><span class="p">,</span> <span class="s">'him'</span><span class="p">],</span>

                 <span class="p">[</span><span class="s">'stop'</span><span class="p">,</span> <span class="s">'posting'</span><span class="p">,</span> <span class="s">'stupid'</span><span class="p">,</span> <span class="s">'worthless'</span><span class="p">,</span> <span class="s">'garbage'</span><span class="p">],</span>

                 <span class="p">[</span><span class="s">'mr'</span><span class="p">,</span> <span class="s">'licks'</span><span class="p">,</span> <span class="s">'ate'</span><span class="p">,</span> <span class="s">'my'</span><span class="p">,</span> <span class="s">'steak'</span><span class="p">,</span> <span class="s">'how'</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="s">'stop'</span><span class="p">,</span> <span class="s">'him'</span><span class="p">],</span>

                 <span class="p">[</span><span class="s">'quit'</span><span class="p">,</span> <span class="s">'buying'</span><span class="p">,</span> <span class="s">'worthless'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'food'</span><span class="p">,</span> <span class="s">'stupid'</span><span class="p">]]</span>

    <span class="n">classVec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>    <span class="c1">#1 is abusive, 0 not
</span>
    <span class="k">return</span> <span class="n">postingList</span><span class="p">,</span><span class="n">classVec</span>



<span class="k">def</span> <span class="nf">createVocabList</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>

    <span class="n">vocabSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>  <span class="c1"># åˆ›å»ºä¸€ä¸ªç©ºè¯æ±‡é›†åˆ
</span>
    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">:</span>

        <span class="n">vocabSet</span> <span class="o">=</span> <span class="n">vocabSet</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>  <span class="c1"># å°†æ–‡æ¡£ä¸­æ¯ä¸€è¡Œçš„è¯æ±‡é›†åˆä¸å½“å‰è¯æ±‡é›†åˆä½œå¹¶é›†
</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">vocabSet</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">words2Vec_set</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">inputSet</span><span class="p">):</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'int'</span><span class="p">)</span>  <span class="c1"># åˆ›å»ºä¸€ä¸ªç­‰é•¿äºè¯æ±‡é›†åˆçš„ç”±0ç»„æˆçš„è¡¨
</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">inputSet</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabList</span><span class="p">:</span>

            <span class="n">result</span><span class="p">[</span><span class="n">vocabList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># è‹¥å•è¯å‡ºç°ï¼Œåˆ™åœ¨åˆ—è¡¨ä¸­å¯¹åº”ä½ç½®å°†å€¼ç½®1
</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">print</span><span class="p">(</span><span class="s">"the word </span><span class="si">%</span><span class="s">s is not in vocabulary"</span> <span class="o">%</span> <span class="n">word</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

</code></pre></div></div>

<p>loadDataSetå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®é›†åˆç”¨äºæµ‹è¯•ï¼ŒcreateVocabListå‡½æ•°æ ¹æ®æ•°æ®é›†åˆ›å»ºå¹¶è¿”å›äº†ä¸€ä¸ªè¯æ±‡é›†åˆï¼Œword2Vecå‡½æ•°æ ¹æ®å·²æœ‰çš„è¯æ±‡é›†åˆä»¥åŠè¾“å…¥é›†åˆï¼Œç”±å•è¯æ˜¯å¦å‡ºç°æ„å»º0-1åˆ—è¡¨å¹¶è¿”å›</p>

<h3 id="è®­ç»ƒç®—æ³•ä»è¯å‘é‡è®¡ç®—æ¦‚ç‡">è®­ç»ƒç®—æ³•ï¼šä»è¯å‘é‡è®¡ç®—æ¦‚ç‡</h3>

<p>ä¸‹é¢æ˜¯æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨è®­ç»ƒå‡½æ•°</p>

<p>æ ¹æ®æˆ‘ä»¬å·²æœ‰çš„æ•°æ®ä¿®æ”¹è´å¶æ–¯å‡†åˆ™ï¼šå°†x,yæ›¿æ¢ä¸º<strong>w</strong>:  <img src="http://latex.codecogs.com/gif.latex?p%28c_i%7Cw%29%20%3D%20%5Cfrac%7Bp%28w%7Cc_i%29%20p%28c_i%29%7D%7Bp%28w%29%7D" /></p>

<p>è¿™é‡Œçš„<strong>w</strong>æŒ‡çš„æ˜¯ä¸€ä¸ªå‘é‡ï¼Œç”±å¤šä¸ªæ•°å€¼ç»„æˆã€‚ç”±æœ´ç´ è´å¶æ–¯å‡è®¾å¯çŸ¥ï¼Œ<img src="http://latex.codecogs.com/gif.latex?%24p%28w%7Cc_i%29%20%3D%20%5Cprod%5En_%7Bj%3D1%7Dp%28w_j%7Cc_i%29%24" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">trainNB</span><span class="p">(</span><span class="n">trainMatrix</span><span class="p">,</span> <span class="n">trainCategory</span><span class="p">):</span>

    <span class="s">"""

    trainMatrix: æ–‡æ¡£çŸ©é˜µ

    trainCategory: æ–‡æ¡£ç±»åˆ«æ ‡ç­¾

    """</span>

    <span class="n">numTrainDocs</span> <span class="o">=</span> <span class="n">trainMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">numWords</span> <span class="o">=</span> <span class="n">trainMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">p_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">trainCategory</span><span class="p">)</span> <span class="o">/</span> <span class="n">numTrainDocs</span>  <span class="c1"># è®¡ç®—ä¾®è¾±æ€§æ–‡æ¡£åœ¨æ€»æ–‡æ¡£ä¸­å æ¯”
</span>
    <span class="n">p_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numWords</span><span class="p">)</span>  <span class="c1"># ç»Ÿè®¡ä¾®è¾±æ€§æ–‡æ¡£ä¸­å•è¯å‡ºç°æ¬¡æ•°
</span>
    <span class="n">p_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numWords</span><span class="p">)</span>  <span class="c1"># ç»Ÿè®¡éä¾®è¾±æ€§æ–‡æ¡£ä¸­å•è¯å‡ºç°æ¬¡æ•°
</span>
    

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numTrainDocs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">trainCategory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">p_1</span> <span class="o">+=</span> <span class="n">trainMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">p_0</span> <span class="o">+=</span> <span class="n">trainMatrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    

    <span class="c1"># è®¡ç®—p(wj|ci)
</span>
    <span class="n">p_1_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">p_1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># è®¡ç®—ä¾®è¾±æ€§æ–‡æ¡£ä¸­å•è¯å‡ºç°çš„å æ¯”
</span>
    <span class="n">p_0_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">p_0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># è®¡ç®—éä¾®è¾±æ€§æ–‡æ¡£ä¸­å•è¯å‡ºç°çš„å æ¯”
</span>
    

    <span class="k">return</span> <span class="n">p_0_vec</span><span class="p">,</span> <span class="n">p_1_vec</span><span class="p">,</span> <span class="n">p_c</span>    

</code></pre></div></div>

<p>trainNBå‡½æ•°è¿”å›æ–‡æ¡£åˆ—è¡¨ä¸­ï¼šéä¾®è¾±æ€§æ–‡æ¡£ä¸­å„å•è¯å‡ºç°å æ¯”ï¼Œä¾®è¾±æ€§æ–‡æ¡£ä¸­å„å•è¯å‡ºç°å æ¯”ï¼Œä¾®è¾±æ€§æ–‡æ¡£åœ¨æ€»æ–‡æ¡£ä¸­å æ¯”</p>

<p><strong>æ³¨æ„ï¼š</strong></p>

<ol>
  <li>
    <p>åœ¨åˆå§‹åŒ–å•è¯å‡ºç°æ¬¡æ•°çš„æ—¶å€™ä¸æ˜¯ç”Ÿæˆå…¨0åˆ—è¡¨ï¼Œè€Œæ˜¯å…¨1åˆ—è¡¨çš„åŸå› æ˜¯ï¼šé¿å…åœ¨ä¹‹åå°†æ‰€æœ‰<img src="http://latex.codecogs.com/gif.latex?p%28w_j%7Cc_i%29" />ç›¸ä¹˜æ—¶ç”±äºå•ä¸€å‡ºç°æ¦‚ç‡ä¸º0å¯¼è‡´æœ€ç»ˆç»“æœä¸º0çš„æƒ…å†µ</p>
  </li>
  <li>
    <p>åœ¨æœ€ç»ˆè®¡ç®—<img src="http://latex.codecogs.com/gif.latex?p%28w_j%7Cc_i%29" />æ—¶åœ¨åˆ†æ¯ä¸Š+1æ˜¯ä¸ºäº†é¿å…æ€»å‡ºç°æ¬¡æ•°ä¸º0è€Œå¯¼è‡´åˆ†æ¯ä¸º0æ— æ³•è®¡ç®—é™¤æ³•çš„æƒ…å†µ</p>
  </li>
  <li>
    <p>åœ¨æœ€ç»ˆè®¡ç®—<img src="http://latex.codecogs.com/gif.latex?p%28w_j%7Cc_i%29" />æ—¶å°†æ•´ä½“ç»“æœè¿›è¡Œå¯¹æ•°è®¡ç®—æ˜¯ä¸ºäº†é˜²æ­¢å¤šä¸ªå°æ¦‚ç‡ç›¸ä¹˜å¯¼è‡´è®¡ç®—ç»“æœä¸ç²¾ç¡®</p>
  </li>
</ol>

<p>è‡³æ­¤ï¼Œåˆ†ç±»å™¨å°±å·²ç»è®­ç»ƒå®Œæˆäº†ï¼Œä¸‹é¢å¼€å§‹æµ‹è¯•åˆ†ç±»ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">classifyNB</span><span class="p">(</span><span class="n">vec_to_classify</span><span class="p">,</span> <span class="n">p_0_vec</span><span class="p">,</span> <span class="n">p_1_vec</span><span class="p">,</span> <span class="n">p_class_1</span><span class="p">):</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">vec_to_classify</span> <span class="o">*</span> <span class="n">p_1_vec</span><span class="p">)</span> <span class="o">/</span> <span class="n">p_class_1</span>

    <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">vec_to_classify</span> <span class="o">*</span> <span class="n">p_0_vec</span><span class="p">)</span> <span class="o">/</span> <span class="n">p_class_1</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">p1</span> <span class="o">&gt;</span> <span class="n">p0</span> <span class="k">else</span> <span class="mi">0</span>

</code></pre></div></div>

<p>classifyNBå‡½æ•°æ ¹æ®è´å¶æ–¯å‡†åˆ™è®¡ç®—æ–‡æ¡£å±äºå„åˆ†ç±»çš„æ¦‚ç‡ï¼Œè¿›è¡Œæ¯”è¾ƒåè¿”å›æ¯”è¾ƒç»“æœã€‚</p>

<p>å‡½æ•°ä¸­ä»…è®¡ç®—äº†<img src="http://latex.codecogs.com/gif.latex?p%28w%7Cc_i%29p%28c_i%29" />è€Œæ²¡æœ‰è®¡ç®—<img src="http://latex.codecogs.com/gif.latex?%5Cfrac%7Bp%28w%7Cc_i%29p%28c_i%29%7D%7Bp%28w%29%7D" />çš„åŸå› æ˜¯è¦æ¯”è¾ƒçš„æ¦‚ç‡éƒ½æœ‰ç›¸åŒçš„<img src="http://latex.codecogs.com/gif.latex?p%28w%29" />ï¼Œæ­¤æ—¶åªç”¨æ¯”è¾ƒåˆ†å­å³å¯ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">testingNB</span><span class="p">():</span>

    <span class="n">posts</span><span class="p">,</span> <span class="n">class_list</span> <span class="o">=</span> <span class="n">loadDataSet</span><span class="p">()</span>  <span class="c1"># è·å–æ•°æ®é›†
</span>
    <span class="n">vocab_list</span> <span class="o">=</span> <span class="n">createVocabList</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>  <span class="c1"># è·å–è¯æ±‡é›†åˆ
</span>
    <span class="c1"># æ ¹æ®è¯æ±‡é›†åˆä¸­çš„å•è¯æ˜¯å¦åœ¨æ–‡æ¡£ä¸­å‡ºç°ï¼Œå°†æ–‡æ¡£åˆ—è¡¨è½¬åŒ–ä¸º0-1çŸ©é˜µ
</span>
    <span class="n">trainMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">posts</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">post</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">posts</span><span class="p">):</span>

        <span class="n">trainMat</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">words2Vec_set</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>

    <span class="c1"># è·å–è®­ç»ƒé›†ä¸­çš„ä¿¡æ¯
</span>
    <span class="n">p0_vec</span><span class="p">,</span> <span class="n">p1_vec</span><span class="p">,</span> <span class="n">pAbusive</span> <span class="o">=</span> <span class="n">trainNB</span><span class="p">(</span><span class="n">trainMat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">class_list</span><span class="p">))</span>

    

    <span class="c1"># å‡†å¤‡æµ‹è¯•é›†1
</span>
    <span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="s">'love'</span><span class="p">,</span> <span class="s">'my'</span><span class="p">,</span> <span class="s">'dalmation'</span><span class="p">]</span>

    <span class="n">test_doc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">words2Vec_set</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">,</span> <span class="n">test</span><span class="p">))</span>

    <span class="c1"># åˆ†ç±»
</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"'"</span><span class="o">+</span><span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">+</span><span class="s">"'"</span><span class="p">,</span><span class="s">"classified as :"</span><span class="p">,</span> <span class="n">classifyNB</span><span class="p">(</span><span class="n">test_doc</span><span class="p">,</span> <span class="n">p0_vec</span><span class="p">,</span> <span class="n">p1_vec</span><span class="p">,</span> <span class="n">pAbusive</span><span class="p">))</span>

    <span class="c1"># å‡†å¤‡æµ‹è¯•é›†2
</span>
    <span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="s">'stupid'</span><span class="p">,</span><span class="s">'garbage'</span><span class="p">]</span>

    <span class="n">test_doc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">words2Vec_set</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">,</span> <span class="n">test</span><span class="p">))</span>

    <span class="c1"># åˆ†ç±»
</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"'"</span><span class="o">+</span><span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">+</span><span class="s">"'"</span><span class="p">,</span><span class="s">"classified as :"</span><span class="p">,</span> <span class="n">classifyNB</span><span class="p">(</span><span class="n">test_doc</span><span class="p">,</span> <span class="n">p0_vec</span><span class="p">,</span> <span class="n">p1_vec</span><span class="p">,</span> <span class="n">pAbusive</span><span class="p">))</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">testingNB</span><span class="p">()</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'love my dalmation' classified as : 0

'stupid garbage' classified as : 1
</code></pre></div></div>

<p>testingNBå‡½æ•°ä¸­å°è£…äº†ä¸€æ¬¡å®Œæ•´çš„æ–‡æ¡£åˆ†ç±»æµç¨‹ï¼šå‡†å¤‡è®­ç»ƒé›†ï¼Œè®­ç»ƒåˆ†ç±»å™¨ï¼Œå‡†å¤‡æµ‹è¯•é›†ï¼Œè¿›è¡Œåˆ†ç±»</p>

<h3 id="å‡†å¤‡æ•°æ®æ–‡æ¡£è¯è¢‹æ¨¡å‹">å‡†å¤‡æ•°æ®ï¼šæ–‡æ¡£è¯è¢‹æ¨¡å‹</h3>

<p>ä¹‹å‰ä½¿ç”¨çš„<strong>è¯é›†æ¨¡å‹</strong>å°†æ¯ä¸ªè¯çš„å‡ºç°ä¸å¦ä½œä¸ºä¸€ä¸ªç‰¹å¾ï¼Œå¦‚æœæŸä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°ä¸æ­¢ä¸€æ¬¡ï¼Œåˆ™æ„å‘³ç€è¯¥è¯å‡ºç°çš„æ¬¡æ•°å¯èƒ½åŒ…å«äº†ä¸€äº›è¯¥è¯å‡ºç°ä¸å¦æ‰€æ²¡æœ‰çš„éšå«ä¿¡æ¯ï¼Œè¿™å°±æ˜¯è¯è¢‹æ¨¡å‹ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">words2Vec_bag</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">inputSet</span><span class="p">):</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabList</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">inputSet</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabList</span><span class="p">:</span>

            <span class="n">result</span><span class="p">[</span><span class="n">vocabList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">result</span>

</code></pre></div></div>

<p>words2Vec_bagå‡½æ•°ä¸­å°†åŸæ¥çš„<code class="highlighter-rouge">result[vocabList.index(word)] = 1</code>æ”¹ä¸ºäº†<code class="highlighter-rouge">result[vocabList.index(word)] += 1</code></p>

<h2 id="ä½¿ç”¨æœ´ç´ è´å¶æ–¯è¿‡æ»¤åƒåœ¾é‚®ä»¶">ä½¿ç”¨æœ´ç´ è´å¶æ–¯è¿‡æ»¤åƒåœ¾é‚®ä»¶</h2>

<h3 id="æ–‡æœ¬è§£æ">æ–‡æœ¬è§£æ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">textParse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">re</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r'\W*'</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span>

</code></pre></div></div>

<p>textParseå‡½æ•°å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ–‡æœ¬æ‹†åˆ†ä¸ºå•è¯åˆ—è¡¨ï¼Œå¹¶å°†æ‰€æœ‰å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™ï¼Œä¸ºäº†åˆ é™¤ä¸€äº›æ²¡æœ‰ä»€ä¹ˆä½œç”¨çš„å•è¯ï¼Œåªè¿”å›æ‹†åˆ†ç»“æœä¸­é•¿åº¦å¤§äº2çš„å•è¯ã€‚</p>

<h3 id="åƒåœ¾é‚®ä»¶æµ‹è¯•">åƒåœ¾é‚®ä»¶æµ‹è¯•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">test_garbage_email</span><span class="p">():</span>

    <span class="n">doc_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">class_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">full_text</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># è¯»å–æ–‡ä»¶
</span>
    <span class="kn">import</span> <span class="nn">os</span>

    <span class="c1">## è¯»å–æ­£å¸¸é‚®ä»¶
</span>
    <span class="n">base_dir_spam</span> <span class="o">=</span> <span class="s">'data/email/spam'</span>

    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">base_dir_spam</span><span class="p">):</span>

        <span class="n">word_list</span> <span class="o">=</span> <span class="n">textParse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">base_dir_spam</span><span class="o">+</span><span class="s">'/'</span><span class="o">+</span><span class="nb">file</span><span class="p">,</span><span class="s">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>  <span class="c1"># æ‹†åˆ†æ–‡æ¡£å†…å®¹
</span>
        <span class="n">doc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span>

        <span class="n">full_text</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span>

        <span class="n">class_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">## è¯»å–åƒåœ¾é‚®ä»¶
</span>
    <span class="n">base_dir_ham</span> <span class="o">=</span> <span class="s">'data/email/ham'</span>

    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">base_dir_ham</span><span class="p">):</span>

        <span class="s">"""fileName = base_dir_ham+'/'+file

        print(fileName)

        with open(fileName, '') as f:

            content = f.read()"""</span>

        <span class="n">word_list</span> <span class="o">=</span> <span class="n">textParse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">base_dir_ham</span><span class="o">+</span><span class="s">'/'</span><span class="o">+</span><span class="nb">file</span><span class="p">,</span><span class="s">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>  <span class="c1"># æŸ¥åˆ†æ–‡æ¡£å†…å®¹
</span>
        <span class="n">doc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span>

        <span class="n">full_text</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span>

        <span class="n">class_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    

    <span class="c1"># è®­ç»ƒåˆ†ç±»å™¨
</span>
    <span class="n">vocab_list</span> <span class="o">=</span> <span class="n">createVocabList</span><span class="p">(</span><span class="n">doc_list</span><span class="p">)</span>

    <span class="n">train_test_ratio</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># è®­ç»ƒæµ‹è¯•é›†æ¯”ä¾‹
</span>
    <span class="n">training_set</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># è®­ç»ƒé›†
</span>
    <span class="n">train_classes</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># è®­ç»ƒé›†æ ‡ç­¾
</span>
    <span class="c1">#train_range = range(len(doc))
</span>
    <span class="c1">## éšæœºæ„å»ºè®­ç»ƒé›†
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">train_test_ratio</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_list</span><span class="p">))):</span>

        <span class="n">rand_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc_list</span><span class="p">))</span>

        <span class="n">training_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rand_index</span><span class="p">))</span>

        <span class="n">train_classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rand_index</span><span class="p">))</span>

    <span class="c1">## æ„å»ºæµ‹è¯•é›†
</span>
    <span class="n">test_set</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># æµ‹è¯•é›†
</span>
    <span class="n">test_classes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># æµ‹è¯•é›†æ ‡ç­¾
</span>
    <span class="n">test_set</span> <span class="o">=</span> <span class="n">doc_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">test_classes</span> <span class="o">=</span> <span class="n">class_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1">## å°†æ–‡æ¡£æ•°æ®è½¬åŒ–ä¸ºçŸ©é˜µ
</span>
    <span class="n">train_mat</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">training_set</span><span class="p">:</span>

        <span class="n">train_mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words2Vec_set</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">,</span> <span class="n">content</span><span class="p">))</span>

    <span class="c1">## è®­ç»ƒåˆ†ç±»å™¨
</span>
    <span class="n">p0_vec</span><span class="p">,</span> <span class="n">p1_vec</span><span class="p">,</span> <span class="n">pSpam</span> <span class="o">=</span> <span class="n">trainNB</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_mat</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_classes</span><span class="p">))</span>

    

    <span class="c1"># æµ‹è¯•åˆ†ç±»å™¨
</span>
    <span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_set</span><span class="p">):</span>

        <span class="n">word_vec</span> <span class="o">=</span> <span class="n">words2Vec_set</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">classifyNB</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">word_vec</span><span class="p">),</span> <span class="n">p0_vec</span><span class="p">,</span> <span class="n">p1_vec</span><span class="p">,</span> <span class="n">pSpam</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">test_classes</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>

            <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"the error rate is </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_count</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">test_set</span><span class="p">)))</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">test_garbage_email</span><span class="p">()</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the error rate is 0.000000
</code></pre></div></div>

<h2 id="ä½¿ç”¨æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ä»ä¸ªäººå¹¿å‘Šä¸­è·å–åŒºåŸŸå€¾å‘">ä½¿ç”¨æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ä»ä¸ªäººå¹¿å‘Šä¸­è·å–åŒºåŸŸå€¾å‘</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">calcMostFreq</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">fullText</span><span class="p">):</span>

    <span class="s">"""

    ç»Ÿè®¡å•è¯å‡ºç°æ¬¡æ•°

    vocabList: è¯æ±‡é›†åˆ

    fullText: æ‰€æœ‰æ–‡æœ¬

    """</span>

    <span class="n">freqDict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabList</span><span class="p">:</span>

        <span class="n">freqDict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullText</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="n">freqDict</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">freqDict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># å°†å•è¯å‡ºç°æ¬¡æ•°æŒ‰ä»å¤§åˆ°å°æ’åˆ—
</span>
    <span class="k">return</span> <span class="n">freqDict</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span>  <span class="c1"># è¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„30ä¸ªå•è¯
</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">localWords</span><span class="p">(</span><span class="n">feed1</span><span class="p">,</span><span class="n">feed0</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">feedparser</span>

    <span class="n">docList</span><span class="o">=</span><span class="p">[];</span> <span class="n">classList</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">fullText</span> <span class="o">=</span><span class="p">[]</span>

    <span class="n">minLen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feed1</span><span class="p">[</span><span class="s">'entries'</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">feed0</span><span class="p">[</span><span class="s">'entries'</span><span class="p">]))</span>  <span class="c1"># è·å–æ•°æ®é›†é•¿åº¦
</span>
    <span class="c1"># æ•°æ®å¤„ç†
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minLen</span><span class="p">):</span>

        <span class="n">wordList</span> <span class="o">=</span> <span class="n">textParse</span><span class="p">(</span><span class="n">feed1</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">'summary'</span><span class="p">])</span>

        <span class="n">docList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wordList</span><span class="p">)</span>

        <span class="n">fullText</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wordList</span><span class="p">)</span>

        <span class="n">classList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># å°†çº½çº¦è®¾ç½®ä¸ºç±»åˆ«1
</span>
        <span class="n">wordList</span> <span class="o">=</span> <span class="n">textParse</span><span class="p">(</span><span class="n">feed0</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s">'summary'</span><span class="p">])</span>

        <span class="n">docList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wordList</span><span class="p">)</span>

        <span class="n">fullText</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wordList</span><span class="p">)</span>

        <span class="n">classList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># å°†æ—§é‡‘å±±è®¾ç½®ä¸ºç±»åˆ«0
</span>
    <span class="n">vocabList</span> <span class="o">=</span> <span class="n">createVocabList</span><span class="p">(</span><span class="n">docList</span><span class="p">)</span>

    

    <span class="c1"># å»é™¤å‡ºç°æ¬¡æ•°æœ€å¤šçš„30ä¸ªè¯è¯­
</span>
    <span class="n">top30Words</span> <span class="o">=</span> <span class="n">calcMostFreq</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span><span class="n">fullText</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">pairW</span> <span class="ow">in</span> <span class="n">top30Words</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">pairW</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">vocabList</span><span class="p">:</span> <span class="n">vocabList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pairW</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    

    <span class="c1"># æ„å»ºæµ‹è¯•é›†
</span>
    <span class="n">trainingSet</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">minLen</span><span class="p">);</span> <span class="n">testSet</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>

        <span class="n">randIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">trainingSet</span><span class="p">))</span>

        <span class="n">testSet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trainingSet</span><span class="p">[</span><span class="n">randIndex</span><span class="p">])</span>

        <span class="k">del</span><span class="p">(</span><span class="n">trainingSet</span><span class="p">[</span><span class="n">randIndex</span><span class="p">])</span>

    <span class="c1"># æ„å»ºè®­ç»ƒé›†
</span>
    <span class="n">trainMat</span><span class="o">=</span><span class="p">[];</span> <span class="n">trainClasses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">docIndex</span> <span class="ow">in</span> <span class="n">trainingSet</span><span class="p">:</span>

        <span class="n">trainMat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words2Vec_bag</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">docList</span><span class="p">[</span><span class="n">docIndex</span><span class="p">]))</span>

        <span class="n">trainClasses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classList</span><span class="p">[</span><span class="n">docIndex</span><span class="p">])</span>

    <span class="n">p0V</span><span class="p">,</span><span class="n">p1V</span><span class="p">,</span><span class="n">pSpam</span> <span class="o">=</span> <span class="n">trainNB</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trainMat</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trainClasses</span><span class="p">))</span>

    

    <span class="c1"># åˆ†ç±»æµ‹è¯•
</span>
    <span class="n">errorCount</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">docIndex</span> <span class="ow">in</span> <span class="n">testSet</span><span class="p">:</span>

        <span class="n">wordVector</span> <span class="o">=</span> <span class="n">words2Vec_bag</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">docList</span><span class="p">[</span><span class="n">docIndex</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">classifyNB</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wordVector</span><span class="p">),</span><span class="n">p0V</span><span class="p">,</span><span class="n">p1V</span><span class="p">,</span><span class="n">pSpam</span><span class="p">)</span> <span class="o">!=</span> <span class="n">classList</span><span class="p">[</span><span class="n">docIndex</span><span class="p">]:</span>

            <span class="n">errorCount</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'the error rate is: '</span><span class="p">,</span> <span class="n">errorCount</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">testSet</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">vocabList</span><span class="p">,</span><span class="n">p0V</span><span class="p">,</span><span class="n">p1V</span>

</code></pre></div></div>
:ET