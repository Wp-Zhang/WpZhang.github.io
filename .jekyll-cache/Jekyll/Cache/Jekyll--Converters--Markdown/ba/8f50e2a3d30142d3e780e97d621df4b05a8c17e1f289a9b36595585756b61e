I"g¢<h2 id="å†³ç­–æ ‘çš„æ„é€ ">å†³ç­–æ ‘çš„æ„é€ </h2>

<blockquote>
  <p>å°†åŸå§‹æ•°æ®é›†åˆ†ä¸ºè‹¥å¹²ä¸ªæ•°æ®å­é›†ï¼Œå®ƒä»¬åˆ†å¸ƒåœ¨ç¬¬ä¸€ä¸ªå†³ç­–ç‚¹çš„æ‰€æœ‰åˆ†æ”¯ä¸Šã€‚è‹¥æŸåˆ†æ”¯ä¸‹çš„æ•°æ®å±äºåŒä¸€ç±»å‹ï¼Œåˆ™å½“å‰æ•°æ®é›†å·²ç»åˆ†ç±»å®Œæˆï¼Œæ— éœ€å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥åˆ†å‰²ï¼›å¦åˆ™é‡å¤åˆ’åˆ†æ•°æ®å­é›†ç›´åˆ°æ¯ä¸ªæ•°æ®å­é›†ä»…åŒ…å«ä¸€ä¸ªç±»å‹çš„æ•°æ®ã€‚</p>
</blockquote>

<h3 id="ä¿¡æ¯å¢ç›Š">ä¿¡æ¯å¢ç›Š</h3>

<blockquote>
  <p>åˆ’åˆ†æ•°æ®é›†çš„å¤§åŸåˆ™æ˜¯ï¼šå°†æ— åºçš„æ•°æ®å˜å¾—æ›´åŠ æœ‰åºã€‚å†åˆ’åˆ†æ•°æ®é›†å‰åä¿¡æ¯å‘ç”Ÿçš„å˜åŒ–ç§°ä¸ºä¿¡æ¯å¢ç›Šï¼Œ é›†åˆä¿¡æ¯çš„åº¦é‡æ–¹å¼ç§°ä¸ºé¦™å†œç†µæˆ–ç†µã€‚</p>
</blockquote>

<h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h4>

<p>Â  Â  Â  Â  ç†µä¸ºä¿¡æ¯çš„æœŸæœ›å€¼ï¼Œè€Œâ€œä¿¡æ¯â€çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<p>Â  Â  Â  Â  Â  Â  Â  Â  è‹¥å¾…åˆ†ç±»çš„äº‹åŠ¡å¯èƒ½åˆ’åˆ†åœ¨å¤šä¸ªåˆ†ç±»ä¸­ï¼Œåˆ™ç¬¦å· <img src="http://latex.codecogs.com/gif.latex?%24x_%7Bi%7D%24" /> çš„ä¿¡æ¯ä¸ºï¼š<img src="http://latex.codecogs.com/gif.latex?l%28x_%7Bi%7D%29%20%3D%20-%5Clog_%7B2%7Dp%28x_%7Bi%7D%29" /> , å…¶ä¸­ <img src="http://latex.codecogs.com/gif.latex?p%28x_%7Bi%7D%29" /> æ˜¯é€‰æ‹©è¯¥åˆ†ç±»çš„æ¦‚ç‡ã€‚</p>

<p>Â  Â  Â  Â  ä¸ºäº†è®¡ç®—ä¿¡æ¯ç†µï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ‰€æœ‰ç±»åˆ«æ‰€æœ‰å¯èƒ½å€¼åŒ…å«çš„ä¿¡æ¯æœŸæœ›å€¼ï¼š</p>

<p>Â  Â  Â  Â  Â  Â  Â  Â  <img src="http://latex.codecogs.com/gif.latex?H%20%3D%20-%20%5Csum%5E%7Bn%7D_%7Bi%3D1%7Dp%28x_%7Bi%7D%29%5Clog_%7B2%7Dp%28x_%7Bi%7D%29" />&lt;/imgï¼Œ&gt;ï¼Œ å…¶ä¸­nä¸ºåˆ†ç±»æ•°ç›®ã€‚</p>

<h4 id="è®¡ç®—é¦™å†œç†µ">è®¡ç®—é¦™å†œç†µ</h4>

<p>ä¸‹é¢æ˜¯è®¡ç®—ç»™å®šæ•°æ®é›†çš„ç†µçš„ä»£ç </p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>



<span class="k">def</span> <span class="nf">calcEnt</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>

    <span class="s">"""

    dataSet: pandas.DataFrameï¼Œæœ€åä¸€åˆ—ä¸ºlabel

    """</span>

    <span class="n">labelCounts</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># å­˜å‚¨æ‰€æœ‰åˆ†ç±»çš„å­—å…¸
</span>
    <span class="c1"># å°†æ‰€æœ‰å¯èƒ½åˆ†ç±»åŠ å…¥å­—å…¸
</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">dataSet</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]:</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labelCounts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">labelCounts</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">labelCounts</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># è®¡ç®—ç†µ
</span>
    <span class="n">ent</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labelCounts</span><span class="p">:</span>

        <span class="n">prob</span> <span class="o">=</span> <span class="n">labelCounts</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">/</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># è®¡ç®—è¯¥åˆ†ç±»å‡ºç°çš„æ¦‚ç‡
</span>
        <span class="n">ent</span> <span class="o">-=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># è®¡ç®—é¦™å†œç†µ
</span>
    <span class="k">return</span> <span class="n">ent</span>

</code></pre></div></div>

<p>å¯ä»¥è‡ªå·±åˆ›å»ºæ•°æ®é›†è¿›è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°ç†µè¶Šé«˜ï¼Œæ··åˆçš„æ•°æ®è¶Šå¤šã€‚</p>

<h3 id="åˆ’åˆ†æ•°æ®é›†">åˆ’åˆ†æ•°æ®é›†</h3>

<p>splitDataSetå‡½æ•°æŠ½å–æ•°æ®é›†ä¸­columnå¯¹åº”çš„åˆ—çš„å€¼ç­‰äºvalueçš„æ‰€æœ‰æ•°æ®</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">splitDataSet</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

    <span class="s">"""

    dataSet: pandas.DataFrameï¼Œæœ€åä¸€åˆ—ä¸ºlabel

    column: åˆ—å

    values: åˆ—åå¯¹åº”åˆ—çš„å€¼

    """</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">dataSet</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">==</span><span class="n">value</span><span class="p">]</span>  <span class="c1"># columnåˆ—çš„å€¼ç­‰äºvalueçš„æ•°æ®é›†
</span>
    <span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># å»æ‰columnåˆ—
</span>
    <span class="k">return</span> <span class="n">result</span>

</code></pre></div></div>

<p>æ¥ä¸‹æ¥éå†æ•´ä¸ªæ•°æ®é›†ï¼Œå¾ªç¯è®¡ç®—é¦™å†œç†µå’Œæ‰§è¡ŒsplitDataSet()å‡½æ•°ï¼Œæ‰¾åˆ°æœ€å¥½çš„ç‰¹å¾åˆ’åˆ†æ–¹å¼ï¼ˆæ ¹æ®ä¹‹å‰æåˆ°çš„é¦™å†œç†µçš„æ•°å€¼ç‰¹ç‚¹å¾—å‡ºï¼‰</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">chooseBestFeatureToSplit</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>

    <span class="n">baseEntropy</span> <span class="o">=</span> <span class="n">calcEnt</span><span class="p">(</span><span class="n">dataSet</span><span class="p">)</span>  <span class="c1"># åˆå§‹é¦™å†œç†µ
</span>
    <span class="n">bestInfoGain</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># å­˜å‚¨æœ€ä½³ä¿¡æ¯å¢ç›Š
</span>
    <span class="n">bestFeature</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># å­˜å‚¨æœ€ä½³ç‰¹å¾
</span>
    

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

        <span class="n">featList</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">uniqueVals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">featList</span><span class="p">)</span>  <span class="c1"># ä¸åŒçš„å€¼
</span>
        <span class="n">newEntropy</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># è®¡ç®—æ¯ç§åˆ’åˆ†æ–¹å¼çš„ä¿¡æ¯ç†µ
</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uniqueVals</span><span class="p">:</span>

            <span class="n">subDataSet</span> <span class="o">=</span> <span class="n">splitDataSet</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="n">prob</span> <span class="o">=</span> <span class="n">subDataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">newEntropy</span> <span class="o">+=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">calcEnt</span><span class="p">(</span><span class="n">subDataSet</span><span class="p">)</span>

        <span class="n">infoGain</span> <span class="o">=</span> <span class="n">baseEntropy</span> <span class="o">-</span> <span class="n">newEntropy</span>  <span class="c1"># ä¿¡æ¯å¢ç›Š
</span>
        <span class="c1"># è®¡ç®—æœ€å¥½çš„ä¿¡æ¯å¢ç›Š
</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">infoGain</span> <span class="o">&gt;</span> <span class="n">bestInfoGain</span><span class="p">):</span>

            <span class="n">bestInfoGain</span> <span class="o">=</span> <span class="n">infoGain</span>

            <span class="n">bestFeature</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="n">bestFeature</span>

</code></pre></div></div>

<h3 id="é€’å½’æ„å»ºå†³ç­–æ ‘">é€’å½’æ„å»ºå†³ç­–æ ‘</h3>

<p>é€’å½’ç»“æŸçš„æ¡ä»¶æ˜¯ï¼šç¨‹åºéå†å®Œæ‰€æœ‰åˆ’åˆ†æ•°æ®é›†çš„å±æ€§ï¼Œæˆ–æ¯ä¸ªåˆ†æ”¯ä¸‹çš„æ‰€æœ‰å®ä¾‹éƒ½å…·æœ‰ç›¸åŒçš„åˆ†ç±»ã€‚å¦‚æœæ‰€æœ‰å®ä¾‹å…·æœ‰ç›¸åŒçš„åˆ†ç±»ï¼Œåˆ™å¾—åˆ°ä¸€ä¸ªå¶å­èŠ‚ç‚¹æˆ–ç»ˆæ­¢å—ã€‚å› æ­¤ä»»ä½•è¾¾åˆ°å¶å­èŠ‚ç‚¹çš„æ•°æ®å¿…ç„¶å±äºå¶å­èŠ‚ç‚¹çš„åˆ†ç±»ã€‚</p>

<p>å¦‚æœæ•°æ®é›†å·²ç»å¤„ç†äº†æ‰€æœ‰å±æ€§ï¼Œä½†æ˜¯ç±»æ ‡ç­¾ä¾ç„¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦å†³å®šå¦‚ä½•å®šä¹‰è¯¥å¶å­èŠ‚ç‚¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡‡ç”¨å¤šæ•°è¡¨å†³çš„æ–¹æ³•å†³å®šè¯¥å¶å­èŠ‚ç‚¹çš„åˆ†ç±»ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">majorityCnt</span><span class="p">(</span><span class="n">classList</span><span class="p">):</span>

    <span class="n">classCount</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">vote</span> <span class="ow">in</span> <span class="n">classList</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">vote</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classCount</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">classCount</span><span class="p">[</span><span class="n">vote</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">classCount</span><span class="p">[</span><span class="n">vote</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">sortedClassCount</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">classCount</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sortedClassCount</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

</code></pre></div></div>

<p>åˆ›å»ºå†³ç­–æ ‘</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">createTree</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>

    <span class="n">classList</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">dataSet</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># å¦‚æœç±»åˆ«å®Œå…¨ç›¸åŒåˆ™åœæ­¢ç»§ç»­åˆ’åˆ†
</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classList</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">classList</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># éå†å®Œæ‰€æœ‰ç‰¹å¾æ˜¯è¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„ç‰¹å¾
</span>
    <span class="k">if</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">majorityCnt</span><span class="p">(</span><span class="n">classList</span><span class="p">)</span>

    

    <span class="n">bestFeat</span> <span class="o">=</span> <span class="n">chooseBestFeatureToSplit</span><span class="p">(</span><span class="n">dataSet</span><span class="p">)</span>

    <span class="n">myTree</span> <span class="o">=</span> <span class="p">{</span><span class="n">bestFeat</span><span class="p">:{}}</span>

    <span class="c1"># å¾—åˆ°åˆ—è¡¨åŒ…å«çš„æ‰€æœ‰å±æ€§å€¼
</span>
    <span class="n">featValues</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">bestFeat</span><span class="p">]</span>

    <span class="n">uniqueVals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">featValues</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uniqueVals</span><span class="p">:</span>

        <span class="n">myTree</span><span class="p">[</span><span class="n">bestFeat</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">createTree</span><span class="p">(</span><span class="n">splitDataSet</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">bestFeat</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">myTree</span>

</code></pre></div></div>

<h2 id="åˆ©ç”¨matplotlibæ³¨è§£ç»˜åˆ¶æ ‘å½¢å›¾">åˆ©ç”¨matplotlibæ³¨è§£ç»˜åˆ¶æ ‘å½¢å›¾</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">decisionNode</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s">"sawtooth"</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">"0.8"</span><span class="p">)</span>

<span class="n">leafNode</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s">"round4"</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">"0.8"</span><span class="p">)</span>

<span class="n">arrow_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s">"&lt;-"</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="ç»˜åˆ¶æ ‘èŠ‚ç‚¹">ç»˜åˆ¶æ ‘èŠ‚ç‚¹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">plotNode</span><span class="p">(</span><span class="n">nodeTxt</span><span class="p">,</span> <span class="n">centerPt</span><span class="p">,</span> <span class="n">parentPt</span><span class="p">,</span> <span class="n">nodeType</span><span class="p">):</span>

    <span class="n">createPlot</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">nodeTxt</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">parentPt</span><span class="p">,</span>  <span class="n">xycoords</span><span class="o">=</span><span class="s">'axes fraction'</span><span class="p">,</span>

             <span class="n">xytext</span><span class="o">=</span><span class="n">centerPt</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s">'axes fraction'</span><span class="p">,</span>

             <span class="n">va</span><span class="o">=</span><span class="s">"center"</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">"center"</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">nodeType</span><span class="p">,</span> <span class="n">arrowprops</span><span class="o">=</span><span class="n">arrow_args</span> <span class="p">)</span>

</code></pre></div></div>

<p>è·å–å¶èŠ‚ç‚¹çš„æ•°ç›®å’Œæ ‘çš„å±‚æ•°</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">getNumLeafs</span><span class="p">(</span><span class="n">myTree</span><span class="p">):</span>

    <span class="n">numLeafs</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">firstStr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">myTree</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">secondDict</span> <span class="o">=</span> <span class="n">myTree</span><span class="p">[</span><span class="n">firstStr</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">secondDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">dict</span><span class="p">):</span>

            <span class="n">numLeafs</span> <span class="o">+=</span> <span class="n">getNumLeafs</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">numLeafs</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">numLeafs</span>



<span class="k">def</span> <span class="nf">getTreeDepth</span><span class="p">(</span><span class="n">myTree</span><span class="p">):</span>

    <span class="n">maxDepth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">firstStr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">myTree</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">secondDict</span> <span class="o">=</span> <span class="n">myTree</span><span class="p">[</span><span class="n">firstStr</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">secondDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">dict</span><span class="p">):</span>

            <span class="n">thisDepth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">getTreeDepth</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">thisDepth</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">thisDepth</span> <span class="o">&gt;</span> <span class="n">maxDepth</span><span class="p">:</span> <span class="n">maxDepth</span> <span class="o">=</span> <span class="n">thisDepth</span>

    <span class="k">return</span> <span class="n">maxDepth</span>

</code></pre></div></div>

<h3 id="ç»˜åˆ¶å†³ç­–æ ‘">ç»˜åˆ¶å†³ç­–æ ‘</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">plotMidText</span><span class="p">(</span><span class="n">cntrPt</span><span class="p">,</span> <span class="n">parentPt</span><span class="p">,</span> <span class="n">txtString</span><span class="p">):</span>

    <span class="n">xMid</span> <span class="o">=</span> <span class="p">(</span><span class="n">parentPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">cntrPt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">cntrPt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">yMid</span> <span class="o">=</span> <span class="p">(</span><span class="n">parentPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">cntrPt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">cntrPt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">createPlot</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xMid</span><span class="p">,</span> <span class="n">yMid</span><span class="p">,</span> <span class="n">txtString</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">"center"</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">"center"</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">plotTree</span><span class="p">(</span><span class="n">myTree</span><span class="p">,</span> <span class="n">parentPt</span><span class="p">,</span> <span class="n">nodeTxt</span><span class="p">):</span><span class="c1">#if the first key tells you what feat was split on
</span>
    <span class="n">numLeafs</span> <span class="o">=</span> <span class="n">getNumLeafs</span><span class="p">(</span><span class="n">myTree</span><span class="p">)</span>  <span class="c1">#this determines the x width of this tree
</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">getTreeDepth</span><span class="p">(</span><span class="n">myTree</span><span class="p">)</span>

    <span class="n">firstStr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">myTree</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>     <span class="c1">#the text label for this node should be this
</span>
    <span class="n">cntrPt</span> <span class="o">=</span> <span class="p">(</span><span class="n">plotTree</span><span class="o">.</span><span class="n">xOff</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">numLeafs</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="n">plotTree</span><span class="o">.</span><span class="n">totalW</span><span class="p">,</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span><span class="p">)</span>

    <span class="n">plotMidText</span><span class="p">(</span><span class="n">cntrPt</span><span class="p">,</span> <span class="n">parentPt</span><span class="p">,</span> <span class="n">nodeTxt</span><span class="p">)</span>

    <span class="n">plotNode</span><span class="p">(</span><span class="n">firstStr</span><span class="p">,</span> <span class="n">cntrPt</span><span class="p">,</span> <span class="n">parentPt</span><span class="p">,</span> <span class="n">decisionNode</span><span class="p">)</span>

    <span class="n">secondDict</span> <span class="o">=</span> <span class="n">myTree</span><span class="p">[</span><span class="n">firstStr</span><span class="p">]</span>

    <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span> <span class="o">=</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">plotTree</span><span class="o">.</span><span class="n">totalD</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">secondDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">__name__</span><span class="o">==</span><span class="s">'dict'</span><span class="p">:</span><span class="c1">#test to see if the nodes are dictonaires, if not they are leaf nodes   
</span>
            <span class="n">plotTree</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">cntrPt</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>        <span class="c1">#recursion
</span>
        <span class="k">else</span><span class="p">:</span>   <span class="c1">#it's a leaf node print the leaf node
</span>
            <span class="n">plotTree</span><span class="o">.</span><span class="n">xOff</span> <span class="o">=</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">xOff</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">plotTree</span><span class="o">.</span><span class="n">totalW</span>

            <span class="n">plotNode</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="n">plotTree</span><span class="o">.</span><span class="n">xOff</span><span class="p">,</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span><span class="p">),</span> <span class="n">cntrPt</span><span class="p">,</span> <span class="n">leafNode</span><span class="p">)</span>

            <span class="n">plotMidText</span><span class="p">((</span><span class="n">plotTree</span><span class="o">.</span><span class="n">xOff</span><span class="p">,</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span><span class="p">),</span> <span class="n">cntrPt</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

    <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span> <span class="o">=</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">plotTree</span><span class="o">.</span><span class="n">totalD</span>

<span class="c1">#if you do get a dictonary you know it's a tree, and the first element will be another dict
</span>


<span class="k">def</span> <span class="nf">createPlot</span><span class="p">(</span><span class="n">inTree</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">'white'</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

    <span class="n">axprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">createPlot</span><span class="o">.</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">axprops</span><span class="p">)</span>    <span class="c1">#no ticks
</span>
    <span class="c1">#createPlot.ax1 = plt.subplot(111, frameon=False) #ticks for demo puropses 
</span>
    <span class="n">plotTree</span><span class="o">.</span><span class="n">totalW</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">getNumLeafs</span><span class="p">(</span><span class="n">inTree</span><span class="p">))</span>

    <span class="n">plotTree</span><span class="o">.</span><span class="n">totalD</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">getTreeDepth</span><span class="p">(</span><span class="n">inTree</span><span class="p">))</span>

    <span class="n">plotTree</span><span class="o">.</span><span class="n">xOff</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">/</span><span class="n">plotTree</span><span class="o">.</span><span class="n">totalW</span><span class="p">;</span> <span class="n">plotTree</span><span class="o">.</span><span class="n">yOff</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

    <span class="n">plotTree</span><span class="p">(</span><span class="n">inTree</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="s">''</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="æµ‹è¯•å’Œå­˜å‚¨åˆ†ç±»å™¨">æµ‹è¯•å’Œå­˜å‚¨åˆ†ç±»å™¨</h2>

<h3 id="ä½¿ç”¨å†³ç­–æ ‘æ‰§è¡Œåˆ†ç±»">ä½¿ç”¨å†³ç­–æ ‘æ‰§è¡Œåˆ†ç±»</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">inputTree</span><span class="p">,</span> <span class="n">featLabels</span><span class="p">,</span> <span class="n">testVec</span><span class="p">):</span>

    <span class="n">firstStr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inputTree</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">secondDict</span> <span class="o">=</span> <span class="n">inputTree</span><span class="p">[</span><span class="n">firstStr</span><span class="p">]</span>

    <span class="n">featIndex</span> <span class="o">=</span> <span class="n">featLabels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">firstStr</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">secondDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="k">if</span> <span class="n">testVec</span><span class="p">[</span><span class="n">featIndex</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>

                <span class="n">classLabel</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">featLabels</span><span class="p">,</span> <span class="n">testVec</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">classLabel</span> <span class="o">=</span> <span class="n">secondDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">classLabel</span>

</code></pre></div></div>

<h3 id="å­˜å‚¨å†³ç­–æ ‘">å­˜å‚¨å†³ç­–æ ‘</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">storeTree</span><span class="p">(</span><span class="n">inputTree</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">pickle</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">inputTree</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">grabTree</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">pickle</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="ä½¿ç”¨å†³ç­–æ ‘é¢„æµ‹éšå½¢çœ¼é•œç±»å‹">ä½¿ç”¨å†³ç­–æ ‘é¢„æµ‹éšå½¢çœ¼é•œç±»å‹</h2>

<h3 id="è¯»å–æ–‡ä»¶">è¯»å–æ–‡ä»¶</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">txt2csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>

    <span class="c1"># æ‰“å¼€æ–‡ä»¶æŒ‰è¡Œè¯»å–
</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># å°†æ¯ä¸€è¡Œæ•°æ®é—´éš”æ–¹å¼ç”±'\t'æ”¹ä¸º','
</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

        <span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="s">','</span><span class="p">)</span>

    <span class="c1"># å°†åˆ—åæ’å…¥æ•°æ®å¤´éƒ¨
</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span>

    <span class="n">content</span> <span class="o">+=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># å­˜å‚¨ä¿®æ”¹åçš„æ•°æ®ä¸º.csvæ–‡ä»¶
</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">'.csv'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">txt2csv</span><span class="p">(</span><span class="s">'data/lenses.txt'</span><span class="p">,</span> <span class="p">[</span><span class="s">'age'</span><span class="p">,</span><span class="s">'prescript'</span><span class="p">,</span><span class="s">'astigmatic'</span><span class="p">,</span><span class="s">'tearRate'</span><span class="p">,</span><span class="s">'label'</span><span class="p">])</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/lenses.csv'</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">lensesTree</span> <span class="o">=</span> <span class="n">createTree</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">createPlot</span><span class="p">(</span><span class="n">lensesTree</span><span class="p">)</span>

</code></pre></div></div>

<p><img src="/img/in-post/old/output_44_1_20190326122306690649.png" alt="" /></p>
:ET