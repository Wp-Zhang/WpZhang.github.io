I"ª<h3 id="ä¸€åˆ›å»ºscrapyé¡¹ç›®">ä¸€ã€åˆ›å»ºScrapyé¡¹ç›®</h3>
<p>åœ¨cmdä¸­è¾“å…¥ä¸€ä¸‹æŒ‡ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„scrapyé¡¹ç›®åŠä¸€ä¸ªçˆ¬è™«</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scrapy</span> <span class="n">startproject</span> <span class="n">JD_Goods</span>

<span class="n">cd</span> <span class="n">JD_Goods</span>

<span class="n">scrapy</span> <span class="n">genspider</span> <span class="o">-</span><span class="n">t</span> <span class="n">basic</span> <span class="n">goods</span> <span class="n">jd</span><span class="p">.</span><span class="n">com</span>
</code></pre></div></div>

<h3 id="äºŒå®¹å™¨è®¾ç½®">äºŒã€å®¹å™¨è®¾ç½®</h3>
<p>åœ¨äº¬ä¸œå•†åŸç¬”è®°æœ¬ç”µè„‘åˆ†ç±»ä¸‹è¿›å…¥ä¸€ä¸ªå•†å“é¡µé¢ï¼Œåœ¨â€œâ€è§„æ ¼ä¸åŒ…è£…â€æ ä¸‹å¯ä»¥çœ‹è§è¯¥ç¬”è®°æœ¬ç”µè„‘çš„è¯¦ç»†ä¿¡æ¯</p>

<p><img src="/media/editor/20180810201914623_20190219140556252473.png" alt="" /></p>

<p>ç»è¿‡ç­›é€‰ï¼Œåœ¨items.pyä¸‹è®¾ç½®ä¸‹åˆ—å®¹å™¨(å¿½ç•¥æˆ‘çš„Chinglishå‘½åæ³•â€¦)ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">#å•†å“åç§°
</span>    <span class="n">name</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#ä»·æ ¼
</span>    <span class="n">price</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#é“¾æ¥
</span>    <span class="n">link</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#å†…å­˜
</span>    <span class="n">internalStorage</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#CPUç±»å‹
</span>    <span class="n">cpuType</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#CPUå‹å·
</span>    <span class="n">cpuModel</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#CPUé€Ÿåº¦
</span>    <span class="n">cpuSpeed</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#CPUæ ¸å¿ƒ
</span>    <span class="n">cpuCore</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#ç¡¬ç›˜å®¹é‡
</span>    <span class="n">diskCapacity</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#å›ºæ€ç¡¬ç›˜
</span>    <span class="n">SSD</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#æ˜¾å¡ç±»å‹
</span>    <span class="n">GCtype</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#æ˜¾ç¤ºèŠ¯ç‰‡
</span>    <span class="n">GCcore</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#æ˜¾å­˜å®¹é‡
</span>    <span class="n">GCcapacity</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#å°ºå¯¸
</span>    <span class="n">size</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
    <span class="c1">#é‡é‡
</span>    <span class="n">weight</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="n">Field</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="ä¸‰çˆ¬è™«ç¼–å†™">ä¸‰ã€çˆ¬è™«ç¼–å†™</h3>
<p>æ•´ä¸ªé¡¹ç›®å†™å®Œåéƒ½ç”¨åˆ°äº†è¿™äº›åº“ï¼Œä»å¤´å¼€å§‹å†™çš„æ—¶å€™å¯ä»¥å…ˆä¸€æ¬¡æ€§importå®Œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">JD_goods.items</span> <span class="kn">import</span> <span class="n">JdGoodsItem</span>
<span class="kn">from</span> <span class="nn">scrapy.http</span> <span class="kn">import</span> <span class="n">Request</span>
<span class="kn">import</span> <span class="nn">scrapy</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
</code></pre></div></div>

<p>Â  Â  Â  Â ç”±äºè¦å¾—åˆ°ç¬”è®°æœ¬ç”µè„‘çš„è¯¦ç»†ä¿¡æ¯éœ€è¦è¿›å…¥æ¯å°ç¬”è®°æœ¬ç”µè„‘çš„å•ç‹¬çš„é¡µé¢ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™å°†æ‰€æœ‰ç¬”è®°æœ¬ç”µè„‘çš„é“¾æ¥çˆ¬å–åˆ°é“¾è¡¨ä¸­ã€‚é¦–å…ˆåˆ†ææ¯ä¸€é¡µçš„urlè§„å¾‹ï¼Œå‘ç°è§„å¾‹ä¸ºï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"https://list.jd.com/list.html?cat=670,671,672&amp;page="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">é¡µç </span><span class="p">)</span> <span class="o">+</span> <span class="s">"&amp;sort=sort_totalsales15_desc&amp;trans=1&amp;JL=6_0_0#J_main"</span>
</code></pre></div></div>
<p>ç„¶ååˆ†æé¡µé¢ä¸­åŒ…å«æœ«å°¾é¡µæ•°çš„ä¿¡æ¯ï¼Œç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">start_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#TOTALä¸ºæ€»é¡µæ•°
</span>        <span class="n">url</span> <span class="o">=</span> <span class="s">"https://list.jd.com/list.html?    cat=670,671,672&amp;page=1&amp;sort=sort_totalsales15_desc&amp;trans=1&amp;JL=6_0_0#J_main"</span>
        <span class="n">TOTAL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'&lt;em&gt;å…±&lt;b&gt;(.*?)&lt;/b&gt;'</span><span class="p">,</span><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">read</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span><span class="s">'ignore'</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>

<p>æ‰€ä»¥ç”¨ä»¥ä¸‹ä»£ç å°†urlé“¾æ¥å­˜å…¥listä¸­ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="bp">self</span><span class="p">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s">"https://list.jd.com/list.html?cat=670,671,672&amp;page="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">"&amp;sort=sort_totalsales15_desc&amp;trans=1&amp;JL=6_0_0#J_main"</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">read</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span> <span class="s">'ignore'</span><span class="p">)</span>
                <span class="n">link_pattern</span> <span class="o">=</span> <span class="s">'&lt;a target="_blank" title="" href="(.*?)"&gt;'</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">links</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">link_pattern</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">link_pattern</span><span class="p">,</span> <span class="n">page</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"ç¬¬"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">"é¡µå¤„ç†å®Œæˆ"</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s">'code'</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s">'reason'</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">continue</span>
</code></pre></div></div>

<p>å‘ç°æå–å‡ºçš„å•†å“urlå‰éƒ½ç¼ºå°‘äº†â€œhttps:â€ï¼ŒäºŒæ¬¡å¤„ç†ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">)):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">'https:'</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></div>
<p>ç”±äºä¹‹åæ¯æ¬¡çˆ¬å–å•†å“çš„ä¿¡æ¯æ—¶éœ€è¦åœ¨self.linksåˆ—è¡¨ä¸­è°ƒç”¨ä¸åŒindexå¯¹åº”çš„urlï¼Œè¿™é‡Œè®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡indexå¹¶è®¾ç½®ä¸º0ï¼Œç„¶åstart_requestæ–¹æ³•å°±ç»“æŸäº†:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">global</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">headers</span><span class="o">=</span><span class="n">ua</span><span class="p">)</span>
</code></pre></div></div>
<p>æ¥ä¸‹æ¥ç parseæ–¹æ³•çš„ä»£ç ï¼š</p>

<p>é¦–å…ˆå®ä¾‹åŒ–itemå¯¹è±¡</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">JdGoodsItem</span><span class="p">()</span>
</code></pre></div></div>
<p>ç„¶ååˆ†æå„ä¿¡æ¯åœ¨ç½‘é¡µæºç ä¸­çš„ä½ç½®å¹¶æå–ï¼Œæ³¨æ„æ­¤æ—¶linkåœ¨star_request()ä¸­å·²ç»æå–å®Œäº†ï¼Œè¿™é‡Œè°ƒç”¨indexå–å‡ºï¼Œå¹¶è®©indexè‡ªå¢ï¼Œç”±äºxpathä¸æ–¹ä¾¿æå–æ‰€éœ€è¦çš„æ ‡ç­¾å†…å®¹ï¼Œè¿™é‡Œä¾ç„¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">data</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//img[@id="spec-img"]/@alt'</span><span class="p">).</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'link'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="n">page_content</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'link'</span><span class="p">]).</span><span class="n">read</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'gbk'</span><span class="p">,</span><span class="s">'ignore'</span><span class="p">)</span>

        <span class="n">pattern1</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;å†…å­˜å®¹é‡&lt;/dt&gt;.*?&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">pattern2</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;å†…å­˜ç±»å‹&lt;/dt&gt;.*?&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result1</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span><span class="n">page_content</span><span class="p">,</span><span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="p">)</span>
        <span class="n">result2</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span><span class="n">page_content</span><span class="p">,</span><span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'internalStorage'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">result1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">'    '</span><span class="o">+</span><span class="n">result2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'internalStorage'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'internalStorage'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'internalStorage'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;CPUç±»å‹&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuType'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuType'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>


        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;CPUå‹å·&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuModel'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuModel'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;CPUé€Ÿåº¦&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuSpeed'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuSpeed'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">' '</span><span class="p">]</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;æ ¸å¿ƒ&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuCore'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'cpuCore'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;ç¡¬ç›˜å®¹é‡&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'diskCapacity'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'diskCapacity'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;å›ºæ€ç¡¬ç›˜&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'SSD'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'SSD'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;ç±»å‹&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'GCtype'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'GCtype'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;æ˜¾ç¤ºèŠ¯ç‰‡&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'GCcore'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'GCcore'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;æ˜¾å­˜å®¹é‡&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'GCcapacity'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'GCcapacity'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;å°ºå¯¸&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'size'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'size'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="s">'&lt;dt&gt;å‡€é‡&lt;/dt&gt;&lt;dd&gt;(.*?)&lt;/dd&gt;'</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">page_content</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'weight'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s">'weight'</span><span class="p">]</span> <span class="o">=</span> <span class="s">' '</span>
</code></pre></div></div>

<p>ï¼ˆå…¶å®è¿™é‡Œå¯ä»¥å¦å¤–å®šä¹‰ä¸€ä¸ªå‡½æ•°è¿›è¡Œç›¸åº”æ“ä½œç®€åŒ–ä»£ç ï¼ŒåæœŸæœ‰æ—¶é—´æˆ‘ä¼šæ”¹è¿›çš„ï¼‰</p>

<p>åœ¨ç½‘é¡µæºç ä¸­æ— æ³•æ‰¾åˆ°ä»·æ ¼ä¿¡æ¯ï¼Œäºæ˜¯é‡‡ç”¨æŠ“åŒ…åˆ†æï¼Œå¾—åˆ°ä»·æ ¼æ‰€åœ¨çš„jsonæ–‡ä»¶åœ°å€ï¼Œç„¶åæå–ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">#è·å–å•†å“ä»·æ ¼
</span>        <span class="n">good_id</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'.*/(.*?).html'</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s">'link'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">price_url</span> <span class="o">=</span> <span class="s">'https://p.3.cn/prices/mgets?&amp;skuIds=J_'</span> <span class="o">+</span> <span class="n">good_id</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">price_url</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">price_url</span><span class="p">)</span>
        <span class="n">Json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'price'</span><span class="p">]</span> <span class="o">=</span> <span class="n">Json</span><span class="p">[</span><span class="s">'p'</span><span class="p">]</span>
</code></pre></div></div>
<p>æœ€åï¼Œè¿”å›itemå¯¹è±¡å¹¶è®¾ç½®å¾ªç¯çˆ¬å–ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">yield</span> <span class="n">data</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">)):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">parse</span><span class="p">)</span>
</code></pre></div></div>
<p>è‡³æ­¤ï¼Œçˆ¬è™«æ–‡ä»¶çš„ä»£ç å°±ç å®Œäº†</p>

<h3 id="å››å†™å…¥mysql">å››ã€å†™å…¥Mysql</h3>
<p>é¦–å…ˆåœ¨settings.pyä¸­è®¾ç½®å¥½ç›¸å…³ä¿¡æ¯ï¼Œç„¶åè¿›å…¥pipelines.pyã€‚ä¸ºäº†åœ¨å¤„ç†æ•°æ®æ—¶å®æ—¶åé¦ˆï¼Œå†è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡iï¼Œç„¶åè¿›è¡Œæ•°æ®å¤„ç†ï¼ˆæˆ‘çš„æœºå­åœ¨è¿›è¡Œquery() insertæ“ä½œåæ•°æ®åº“å†…è¿˜æ˜¯ç©ºç™½çš„ï¼Œäºæ˜¯è¿›è¡Œæ‰‹åŠ¨commitï¼‰</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">JdGoodsPipeline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">pymysql</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">'root'</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">'Zwp0816...'</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">'JD_Goods'</span><span class="p">)</span>
        <span class="c1"># print("index" + str(i))
</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'name'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#print(name)
</span>        <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'price'</span><span class="p">]</span>
        <span class="c1">#print(price)
</span>        <span class="n">internalStorage</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'internalStorage'</span><span class="p">]</span>
        <span class="c1">#print(internalStorage)
</span>        <span class="n">cpuType</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'cpuType'</span><span class="p">]</span>
        <span class="c1"># print(item['cpuType'])
</span>        <span class="n">cpuModel</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'cpuModel'</span><span class="p">]</span>
        <span class="c1"># print(item['cpuModel'])
</span>        <span class="n">cpuSpeed</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'cpuSpeed'</span><span class="p">]</span>
        <span class="c1"># print(item['cpuSpeed'])
</span>        <span class="n">cpuCore</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'cpuCore'</span><span class="p">]</span>
        <span class="c1"># print(item['cpuCore'])
</span>        <span class="n">diskCapacity</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'diskCapacity'</span><span class="p">]</span>
        <span class="c1"># print(item['diskCapacity'])
</span>        <span class="n">SSD</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'SSD'</span><span class="p">]</span>
        <span class="c1"># print(item['SSD'])
</span>        <span class="n">GCtype</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'GCtype'</span><span class="p">]</span>
        <span class="c1"># print(item['GCtype'])
</span>        <span class="n">GCcore</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'GCcore'</span><span class="p">]</span>
        <span class="c1"># print(item['GCcore'])
</span>        <span class="n">GCcapacity</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'GCcapacity'</span><span class="p">]</span>
        <span class="c1"># print(item['GCcapacity'])
</span>        <span class="n">size</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'size'</span><span class="p">]</span>
        <span class="c1"># print(item['size'])
</span>        <span class="n">weight</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'weight'</span><span class="p">]</span>
        <span class="c1"># print(item['weight'])
</span>        <span class="n">link</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">'link'</span><span class="p">]</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into pcInfo values('"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">price</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">internalStorage</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">cpuType</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">cpuModel</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">cpuSpeed</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">cpuCore</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">diskCapacity</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">SSD</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">GCtype</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">GCcore</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">GCcapacity</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">size</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">weight</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">link</span> <span class="o">+</span> <span class="s">"');"</span>
        <span class="c1">#print(1)
</span>        <span class="n">database</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">commit</span> <span class="o">=</span> <span class="s">"commit;"</span>
        <span class="c1">#print(2)
</span>        <span class="n">database</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">commit</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">i</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"ç¬¬"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">"ä¸ªå•†å“å¤„ç†å®Œæˆ"</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">database</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">item</span>
</code></pre></div></div>

<h3 id="äº”åç»­é—®é¢˜">äº”ã€åç»­é—®é¢˜</h3>
<p>é—®é¢˜1ï¼šåœ¨å¤„ç†jsonæ–‡ä»¶è·å–priceçš„æ“ä½œæ¬¡æ•°å¤šäº†ä¹‹åä¼šè¿”å› {â€œerrorâ€:â€pdos_captchaâ€}ï¼Œå› æ­¤è·å–priceçš„æ–¹æ³•éœ€è¦æ”¹è¿›ã€‚</p>

<p>è§£å†³åŠæ³•ï¼šåœ¨pduidå€¼åæ·»åŠ 100000-999999çš„éšæœºå€¼</p>

<p>åç»­è·Ÿè¿›ï¼šä½¿ç”¨ä¸Šè¿°æ–¹æ³•çˆ¬å–ä¸€æ®µæ—¶é—´åè¿˜æ˜¯ä¼šè¿”å› {â€œerrorâ€:â€pdos_captchaâ€}ï¼Œåªèƒ½ç”¨åŠ¨æ€é¡µé¢æ¸²æŸ“çš„æ–¹æ³•äº†ã€‚åç»­ä¼šç»™å‡ºç›¸åº”ä»£ç ã€‚</p>

<p>æ›´æ–°ï¼šå·²å†™å‡ºåˆ©ç”¨åŠ¨æ€æ¸²æŸ“è·å–ä»·æ ¼å’Œè¯„è®ºæ•°çš„æ–¹æ³•ï¼Œè¯·ç§»æ­¥Â åˆ©ç”¨åŠ¨æ€æ¸²æŸ“é¡µé¢å¯¹äº¬ä¸œç¬”è®°æœ¬ç”µè„‘ä¿¡æ¯çˆ¬å–</p>
:ET