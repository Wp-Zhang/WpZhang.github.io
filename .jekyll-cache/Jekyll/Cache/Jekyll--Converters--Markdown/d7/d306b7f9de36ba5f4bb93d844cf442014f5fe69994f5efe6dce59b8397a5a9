I"³3<h3 id="ä¸€åˆ©ç”¨urllibçˆ¬å–ç½‘é¡µ">ä¸€ã€åˆ©ç”¨Urllibçˆ¬å–ç½‘é¡µ</h3>
<h5 id="8httpè¯·æ±‚">8.HTTPè¯·æ±‚</h5>

<p>â€ƒâ€ƒHTTPåè®®è¯·æ±‚ä¸»è¦åˆ†ä¸º6ç±»ï¼šGETï¼ŒPOSTï¼ŒDELETEï¼ŒPUTï¼Œ HEADï¼Œ OPTIONS</p>

<h6 id="1-get-è¯·æ±‚">1). GET è¯·æ±‚</h6>

<p>åœ¨æ·˜å®ä¸Šæœç´¢Pythonåè§‚å¯Ÿå¯ä»¥å‘ç°URLç”±
â€˜http://www.taobao.comâ€™
;å˜ä¸ºäº†
â€˜https://s.taobao.com/search?q=Python&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.2017.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170306â€™ï¼Œå…¶ä¸­æ‰€æœç´¢çš„â€˜Pyhtonâ€™åœ¨â€˜search?/q=â€™åã€‚ç”±æ­¤æ¨æµ‹ï¼Œå¦‚æœ URL= â€˜htttp://s.taobao.com/search?q=â€™ + å…³é”®è¯ 
é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥çˆ¬å–æˆ‘ä»¬æƒ³è¦åœ¨æ·˜å®ä¸Šæœç´¢çš„å•†å“çš„ç½‘é¡µä¿¡æ¯ã€‚å› æ­¤å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://s.taobao.com/search?q="</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="s">"Python"</span>
<span class="n">url</span> <span class="o">+=</span> <span class="n">keyword</span> 
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"D:/Pyhton/2.html"</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>è¿™æ ·å°±ä¿å­˜äº†æ·˜å®æœç´¢å…³é”®è¯ä¸ºâ€œPythonâ€çš„ç½‘é¡µä¿¡æ¯ã€‚</p>

<p>å¦‚æœæœç´¢å…³é”®è¯å«ä¸­æ–‡æˆ–å…¶ä»–ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œåº”å…ˆå°†å…³é”®è¯ç¼–ç ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://s.taobao.com/search?q="</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="s">"Pythonçˆ¬è™«"</span>
<span class="n">keyword_code</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
<span class="n">url</span> <span class="o">+=</span> <span class="n">keyword_code</span>
</code></pre></div></div>

<h6 id="2postè¯·æ±‚">2).POSTè¯·æ±‚</h6>

<p>â€ƒâ€ƒå®ç°æ€è·¯ï¼š</p>

<ol>
  <li>
    <p>è®¾ç½®URLç½‘å€ï¼›</p>
  </li>
  <li>
    <p>æ„å»ºè¡¨å•æ•°æ®ï¼Œä½¿ç”¨urllib.parse.urlencodeå¯¹æ•°æ®è¿›è¡Œç¼–ç ï¼›</p>
  </li>
  <li>
    <p>åˆ›å»ºRequestå¯¹è±¡ï¼Œå‚æ•°å«URLã€è¦ä¼ é€’çš„æ•°æ®ï¼›</p>
  </li>
  <li>
    <p>ä½¿ç”¨urllib.request.urlopen()æ‰“å¼€Requestå¯¹è±¡ï¼›</p>
  </li>
  <li>
    <p>åç»­å¤„ç†ã€‚</p>
  </li>
</ol>

<p><strong>é‡ç‚¹ï¼šæ„å»ºè¡¨å•æ•°æ®å¹¶å¯¹å…¶ç¼–ç ï¼š</strong></p>

<p>â€ƒâ€ƒæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°å¯¹åº”çš„formè¡¨å•éƒ¨åˆ†ï¼Œæ‰¾åˆ°è¾“å…¥æ¡†å±æ€§å€¼ï¼Œå°†å…¶åŒ…å«äºæ„é€ çš„æ•°æ®ä¸­ï¼Œæ ¼å¼ä¸ºå­—å…¸ï¼Œå±æ€§å€¼åœ¨å­—å…¸ä¸­å¯¹åº”çš„å€¼ä¸ºè¦ä¼ é€’çš„å€¼ã€‚æ­¤å¤„ç”¨â€œhttp://www.iqianyue.com/mypost/â€ä½œä¸ºä¾‹å­ï¼Œæ„å»ºè¡¨å•éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.iqianyue.com/mypost/"</span>
<span class="n">postdata</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">urlencode</span><span class="p">({</span>
<span class="s">"name"</span><span class="p">:</span><span class="s">"12345678@163.com"</span><span class="p">,</span>
<span class="s">"password"</span><span class="p">:</span><span class="s">"Aa12345"</span>
<span class="p">}).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1">#å°†æ•°æ®å¤„ç†åè®¾ç½®ä¸ºutf-8ç¼–ç 
</span><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">postdata</span><span class="p">)</span>
</code></pre></div></div>

<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.iqianyue.com/mypost/"</span>
<span class="n">postdata</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">urlencode</span><span class="p">({</span>
<span class="s">"name"</span><span class="p">:</span><span class="s">"123456@163.com"</span><span class="p">,</span>
<span class="s">"password"</span><span class="p">:</span><span class="s">"Aa12345"</span>
<span class="p">}).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">postdata</span><span class="p">)</span>
<span class="n">request</span><span class="p">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'User-Agent'</span><span class="p">,</span> <span class="s">'Mozilla/5.0'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"D:/3.html"</span><span class="p">,</span><span class="s">'wb'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<h5 id="9è®¾ç½®ä»£ç†æœåŠ¡å™¨">9.è®¾ç½®ä»£ç†æœåŠ¡å™¨</h5>

<ol>
  <li>
    <p>ä½¿ç”¨Â  urllib.request.ProxyHandler({â€˜httpâ€™:Proxy_addr})Â  è®¾ç½®ä»£ç†æœåŠ¡å™¨ä¿¡æ¯ï¼Œå…¶ä¸­Proxy_addrä¸ºâ€œç½‘å€ï¼šç«¯å£å·â€ï¼›</p>
  </li>
  <li>
    <p>åˆ›å»ºä¸€ä¸ªopenerå¯¹è±¡ï¼Œä»¥ä»£ç†æœåŠ¡å™¨ä¿¡æ¯å’Œurllib.request.HTTPHandlerä¸ºå‚æ•° ï¼›</p>
  </li>
  <li>
    <p>åˆ›å»ºå…¨å±€é»˜è®¤çš„openerå¯¹è±¡ï¼›</p>
  </li>
  <li>
    <p>åç»­æ“ä½œï¼›</p>
  </li>
</ol>

<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">proxy</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="s">'http'</span><span class="p">:</span><span class="s">'116.55.77.81:61201'</span><span class="p">})</span>  <span class="c1">#a
</span><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">HTTPHandler</span><span class="p">)</span>  <span class="c1">#b
</span><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">install_opener</span><span class="p">(</span> <span class="n">opener</span><span class="p">)</span>  <span class="c1">#c
</span><span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">).</span><span class="n">read</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>  <span class="c1">#d
</span></code></pre></div></div>

<h5 id="10urlerror">10.URLError</h5>

<p>è¿™é‡Œä¸»è¦ä½¿ç”¨ä¸¤ä¸ªç±»ï¼šURLErrorç±» åŠå…¶å­ç±» HTTPErrorç±»</p>

<p>ä½¿ç”¨ä»£ç ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div></div>
<p>äº§ç”ŸURLErrorçš„å¯èƒ½æœ‰ï¼š</p>

<p>â€ƒâ€ƒa.è¿ä¸ä¸ŠæœåŠ¡å™¨ï¼›</p>

<p>â€ƒâ€ƒb.è¿œç¨‹URLä¸å­˜åœ¨;</p>

<p>â€ƒâ€ƒc.æ— ç½‘ç»œï¼›</p>

<p>â€ƒâ€ƒd.è§¦å‘ HTTPError</p>

<p>â€ƒâ€ƒè‹¥äº§ç”Ÿ HTTPError å¯ç”¨ HTTPError æ›¿æ¢ except ä¸­çš„ URLErrorï¼Œä½†æ˜¯è¦æå‰è¿›è¡Œåˆ¤æ–­é”™è¯¯ç±»å‹ã€‚è‹¥è§¦å‘å‰ä¸‰ç§é”™è¯¯æ—¶ä½¿ç”¨ except urllib.error.HTTPError as e å°†ä¼šäº§ç”Ÿé”™è¯¯ï¼ŒåŸå› æ˜¯æ— æ³•æ‰“å° e.reasonã€‚å› æ­¤å¯ä»¥å°†ä»£ç å†™æˆï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1">#å…ˆç”¨å­ç±»å¤„ç†ï¼Œè‹¥æ— æ³•å¤„ç†å†ä½¿ç”¨çˆ¶ç±»å¤„ç†
</span>    <span class="k">print</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
<span class="err">ï¼ˆ</span><span class="n">çŠ¶æ€ç åŠå«ä¹‰è§</span><span class="err">ã€Š</span><span class="n">ç²¾é€šPythonç½‘ç»œçˆ¬è™«</span><span class="err">ã€‹</span><span class="n">P48</span><span class="err">ï¼‰</span>
</code></pre></div></div>
:ET