I"Ç*<p>Â  Â  Â  Â  åœ¨è‡ªå·±ç”¨Djangoæ­çš„åšå®¢ç½‘ç«™ä¸Šå†™åšå®¢çš„æ—¶å€™ä¸€ç›´å¾ˆéš¾å—ï¼Œå› ä¸ºåŸºæœ¬çš„markdownæ¨¡å—å¥½åƒå¹¶ä¸æ”¯æŒlatexã€‚ç½‘ä¸Šè™½ç„¶èƒ½æ‰¾åˆ°æ–¹æ³•ä½†æ˜¯æˆ‘å¾ˆæ‡’ï¼Œä¸æƒ³å†ä¸ºè¿™ä¸ªä¿®æ”¹å¾ˆå¤šä»£ç äº†ã€‚ä¹‹å‰ä¸ºäº†åœ¨åšå®¢é‡Œé¢æ˜¾ç¤ºlatexå…¬å¼ä¸€ç›´éƒ½æ˜¯åœ¨è¿™ä¸ªç½‘ç«™<a href="http://latex.codecogs.com/">codecogs</a>ä¸ŠæŠŠå…¬å¼è¾“è¿›å»å†å¤åˆ¶äº§ç”Ÿçš„å›¾ç‰‡é“¾æ¥æ·»åŠ åˆ°åšå®¢é‡Œã€‚å½“å…¬å¼å¾ˆå¤šçš„æ—¶å€™æ˜¯ä¸€ä¸ªå¾ˆæµªè´¹æ—¶é—´çš„äº‹æƒ…ï¼Œå‡ ä¹å°±è¦æ”¾å¼ƒä¸ªäººåšå®¢è½¬æˆ˜ç®€ä¹¦äº†ã€‚</p>

<p>Â  Â  Â  Â  ä»Šå¤©çªç„¶æƒ³åˆ°ä¸€ç§æ›²çº¿æ•‘å›½çš„æ–¹å¼ï¼šå¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡ç« ä¸­çš„latexå…¬å¼ï¼Œç„¶åè‡ªåŠ¨å°†å…¶æ›¿æ¢ä¸ºç›¸åº”çš„å›¾ç‰‡é“¾æ¥ï¼</p>

<p>ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(\$\$.*?\$\$)'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">latex1</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s">'&lt;div align=center&gt;&lt;img src="http://latex.codecogs.com/gif.latex?'</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">({</span><span class="s">''</span><span class="p">:</span><span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'$$'</span><span class="p">,</span><span class="s">''</span><span class="p">)})[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s">'"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">article</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">pattern2</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(\$.*?\$)'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s">'&lt;img src="'</span><span class="o">+</span> <span class="s">'http://latex.codecogs.com/gif.latex?'</span> <span class="o">+</span><span class="n">urlencode</span><span class="p">({</span><span class="s">''</span><span class="p">:</span><span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'$'</span><span class="p">,</span><span class="s">''</span><span class="p">)})[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s">'"&gt;'</span><span class="p">,</span> <span class="n">latex1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'+'</span><span class="p">,</span><span class="s">' '</span><span class="p">)</span>    <span class="c1"># urlencodeä¼šæŠŠç©ºæ ¼æ›¿æ¢ä¸º+å·ï¼Œè¿™é‡ŒæŠŠå®ƒæ›¿æ¢å›æ¥
</span></code></pre></div></div>

<p>Â  Â  Â  Â  è¿™é‡Œçš„patternåŒ¹é…çš„æ˜¯å•è¡Œå…¬å¼ï¼Œpattern2åŒ¹é…çš„æ˜¯è¡Œå†…å…¬å¼ï¼Œå°†åŒ¹é…åˆ°çš„ç»“æœçš„é¦–å°¾çš„å…¬å¼æ ‡è¯†ç¬¦â€™$â€™å»æ‰ä»¥åä½¿ç”¨urllibä¸­çš„parseæ¨¡å—å°†å…¬å¼æ›¿æ¢ä¸ºç›¸åº”çš„å›¾ç‰‡é“¾æ¥ï¼Œç„¶åå°†å…¶åŒ…è£…ä¸ºå¯Œæ–‡æœ¬æ ¼å¼ï¼ˆç”¨æ¥åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºå›¾ç‰‡å¹¶è°ƒæ•´æ’ç‰ˆï¼‰ï¼Œæœ€ç»ˆç”¨ç»“æœæ›¿æ¢åŸæ¥çš„latexå…¬å¼ã€‚</p>

<p>Â  Â  Â  Â  å°†è¿™å‡ è¡Œä»£ç å¤åˆ¶åˆ°djangoé¡¹ç›®ä¸­å•ä¸ªæ–‡ç« çš„viewså‡½æ•°ä¸­ï¼Œåœ¨ä»æ•°æ®åº“è·å¾—æ–‡ç« å†…å®¹åå°†å…¶å¤„ç†ï¼ŒæŠŠå¤„ç†åçš„æ–‡æœ¬å†è¿”å›ç»™è¯·æ±‚å¯¹è±¡ã€‚</p>

<p>åœ¨æˆ‘çš„djangoé¡¹ç›®ä¸­æ˜¯è¿™æ ·çš„ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">article_page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">article_id</span><span class="p">):</span>
    <span class="n">change_info</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">Article</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">article_id</span><span class="p">)</span>

    <span class="n">article</span><span class="p">.</span><span class="n">increase_views</span><span class="p">()</span>

    <span class="c1">############### æ–°å¢åŠ çš„ä»£ç    article.contentæ˜¯æˆ‘çš„æ–‡ç« çš„modelä¸­å¯¹åº”çš„æ–‡ç« å†…å®¹
</span>    <span class="kn">import</span> <span class="nn">re</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(\$\$.*?\$\$)'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="p">)</span>
    <span class="n">latex1</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s">'&lt;div align=center&gt;&lt;img src="http://latex.codecogs.com/gif.latex?'</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">({</span><span class="s">''</span><span class="p">:</span><span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'$$'</span><span class="p">,</span><span class="s">''</span><span class="p">)})[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s">'"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">article</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">pattern2</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(\$.*?\$)'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">S</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s">'&lt;img src="'</span><span class="o">+</span> <span class="s">'http://latex.codecogs.com/gif.latex?'</span> <span class="o">+</span><span class="n">urlencode</span><span class="p">({</span><span class="s">''</span><span class="p">:</span><span class="n">m</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'$'</span><span class="p">,</span><span class="s">''</span><span class="p">)})[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="s">'"&gt;'</span><span class="p">,</span> <span class="n">latex1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1">##############
</span>        
    <span class="n">content</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">content</span><span class="p">,</span>
                                <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
                                    <span class="s">'markdown.extensions.extra'</span><span class="p">,</span>
                                    <span class="s">'markdown.extensions.codehilite'</span><span class="p">,</span>
                                    <span class="s">'markdown.extensions.toc'</span><span class="p">,</span>
                                <span class="p">])</span>
    <span class="n">comment_list</span> <span class="o">=</span> <span class="n">article</span><span class="p">.</span><span class="n">comment_set</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">order_by</span><span class="p">(</span><span class="s">"-created_time"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/newPost.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'article'</span><span class="p">:</span> <span class="n">article</span><span class="p">,</span> <span class="s">'content'</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="s">'comments'</span><span class="p">:</span> <span class="n">comme</span>
<span class="n">nt_list</span><span class="p">})</span>
</code></pre></div></div>

<p>Â  Â  Â  Â  è¿™æ ·æ›´æ”¹ä¹‹åï¼Œç¼–è¾‘åšå®¢å†…å®¹çš„æ—¶å€™å°±å¯ä»¥åƒç®€ä¹¦ä¸­é‚£æ ·æ­£å¸¸ç¼–è¾‘äº†ï½å”¯ä¸€çš„ä¸è¶³æ˜¯ç¼–è¾‘æ–‡ç« çš„æ—¶å€™é¢„è§ˆç•Œé¢ä»ç„¶æ˜¯latexæ ¼å¼çš„å…¬å¼ï¼Œä¸èƒ½é¢„è§ˆã€‚</p>
:ET