I"ú•<h2 id="k-è¿‘é‚»ç®—æ³•åŸºæœ¬å®ç°">k-è¿‘é‚»ç®—æ³•åŸºæœ¬å®ç°</h2>

<h3 id="é€šç”¨å‡½æ•°">é€šç”¨å‡½æ•°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="kn">import</span> <span class="nn">operator</span>



<span class="k">def</span> <span class="nf">createDataSet</span><span class="p">():</span>

    <span class="s">"""

    åˆ›å»ºæ•°æ®é›†

    """</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">'float'</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span><span class="s">'A'</span><span class="p">,</span><span class="s">'B'</span><span class="p">,</span><span class="s">'B'</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">group</span><span class="p">,</span> <span class="n">labels</span>

</code></pre></div></div>

<p>æµ‹è¯•</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">group</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">createDataSet</span><span class="p">()</span>

<span class="n">group</span>

<span class="n">labels</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[1. , 1.1],

       [1. , 1. ],

       [0. , 0. ],

       [0. , 0.1]])













['A', 'A', 'B', 'B']
</code></pre></div></div>

<p>è¯¥å‡½æ•°äº§ç”Ÿ4ä¸ªç‚¹ï¼Œç‚¹çš„ç±»åˆ«åˆ†åˆ«ä¸ºA,A,B,B</p>

<h3 id="ç®—æ³•å®ç°">ç®—æ³•å®ç°</h3>

<ul>
  <li>
    <p>classify0()å‡½æ•°çš„å››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šç”¨äºåˆ†ç±»çš„è¾“å…¥å‘é‡input_Xï¼Œè®­ç»ƒæ ·æœ¬é›†dataSetï¼Œæ ‡ç­¾å‘é‡labelsï¼Œé€‰æ‹©æœ€è¿‘é‚»å±…çš„æ•°ç›®kã€‚æ˜¾ç„¶ï¼Œlabelsçš„å…ƒç´ æ•°ç›®è¦å’ŒdataSetçš„è¡Œæ•°ç›¸åŒï¼ˆè¿™æ ·æ¯ä¸€ä¸ªæ ·æœ¬æ‰æœ‰æ‰€å±çš„æ ‡ç­¾ï¼‰ã€‚</p>
  </li>
  <li>
    <p>è·ç¦»è®¡ç®—ä½¿ç”¨æ¬§å¼è·ç¦»è®¡ç®—å…¬å¼ï¼š<img src="http://latex.codecogs.com/gif.latex?d%20%3D%20%5Csqrt%7B%28xA_%7B0%7D%20-%20xB_%7B0%7D%29%5E%7B2%7D%20&plus;%20%28xA_%7B1%7D%20-%20xB_%7B1%7D%29%5E%7B2%7D%7D" />&lt;/img&gt;ï¼Œæ‹“å±•åˆ°å¤šç»´æ•°æ®è·ç¦»çš„è®¡ç®—åˆ™å…¬å¼ä¸ºï¼š$d&gt;ï¼Œæ‹“å±•åˆ°å¤šç»´æ•°æ®è·ç¦»çš„è®¡ç®—åˆ™å…¬å¼ä¸ºï¼š<img src="http://latex.codecogs.com/gif.latex?%24d%20%3D%20%5Csqrt%7B%5Csum_%7Bi%7D%5E%7Bn%7D%7B%28xA_%7Bi%7D-xB_%7Bi%7D%29%5E%7B2%7D%7D%7D%24" />&lt;/img&gt; å…¶ä¸­nä¸ºç»´åº¦ã€‚</p>
  </li>
</ul>

<h5 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤</h5>

<ol>
  <li>
    <p>é¦–å…ˆè®¡ç®—æ‰€æœ‰ç‚¹ä¹‹é—´çš„è·ç¦»ï¼›</p>
  </li>
  <li>
    <p>å°†è®¡ç®—ç»“æœä»å°åˆ°å¤§ä¾æ¬¡æ’åºï¼›</p>
  </li>
  <li>
    <p>ç¡®å®šå‰kä¸ªè·ç¦»æœ€å°çš„å…ƒç´ æ‰€åœ¨çš„ä¸»è¦åˆ†ç±»ï¼›</p>
  </li>
  <li>
    <p>è¿”å›å‡ºç°é¢‘ç‡æœ€é«˜çš„å…ƒç´ æ ‡ç­¾ã€‚</p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">classify0</span> <span class="p">(</span><span class="n">input_X</span><span class="p">,</span> <span class="n">dataSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>

    <span class="n">dataSetSize</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># æ•°æ®é›†åˆ—æ•°
</span>
    <span class="c1"># è®¡ç®—è·ç¦»
</span>
    <span class="n">diffMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">input_X</span><span class="p">,</span> <span class="p">(</span><span class="n">dataSetSize</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">dataSet</span>

    <span class="c1"># np.tile(input_X, (dataSetSize,1))å°†ç‚¹input_Xå¤åˆ¶ æ•°æ®é›†ä¸­æ‰€æœ‰ç‚¹çš„ä¸ªæ•° æ¬¡ï¼Œ
</span>
    <span class="c1"># å¾—å‡ºçš„ç»“æœå‡å»dataSetåå°±æ±‚å¾—äº†input_Xä¸æ•°æ®é›†ä¸­å„ç‚¹çš„åæ ‡å·®
</span>
    <span class="n">sqDiffMat</span> <span class="o">=</span> <span class="n">diffMat</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># å¹³æ–¹
</span>
    <span class="n">sqDistances</span> <span class="o">=</span> <span class="n">sqDiffMat</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># æ±‚å’Œ
</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">sqDistances</span><span class="o">**</span><span class="mf">0.5</span>  <span class="c1"># å¼€æ–¹å¾—å‡ºè·ç¦»
</span>
    <span class="n">sortedDistIndicies</span> <span class="o">=</span> <span class="n">distances</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>  <span class="c1"># argsort()å°†æ•°ç»„ä»å°åˆ°å¤§æ’åºï¼Œè¿”å›æ¯ä¸ªæ•°åœ¨åŸæ•°ç»„ä¸­çš„ç´¢å¼•ç»„æˆçš„åˆ—è¡¨
</span>
    

    <span class="c1"># é€‰æ‹©è·ç¦»æœ€å°çš„kä¸ªç‚¹
</span>
    <span class="n">classCount</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ç”¨äºç»Ÿè®¡è·ç¦»input_Xæœ€è¿‘çš„kä¸ªç‚¹çš„labelåˆ†å¸ƒï¼Œæ ¼å¼ç±»ä¼¼äº{'A':1, 'B':2}
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>

        <span class="n">voteLabel</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">sortedDistIndicies</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  <span class="c1"># è·å–è·ç¦»input_Xç¬¬iè¿‘çš„ç‚¹çš„label
</span>
        <span class="n">classCount</span><span class="p">[</span><span class="n">voteLabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">classCount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">voteLabel</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># è¯¥labelå‡ºç°æ¬¡æ•°+1
</span>
    

    <span class="c1"># æ’åº
</span>
    <span class="n">sortedClassCount</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">classCount</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># å°†labelå‡ºç°æ¬¡æ•°ç”±å¤§åˆ°å°æ’åº
</span>
    <span class="c1">#sortedClassCount = sorted(classCount.iteritems(), key=operator.itemgetter(1), reverse=True) # åŸä¹¦ä¸Šçš„ä»£ç 
</span>
    <span class="k">return</span> <span class="n">sortedClassCount</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># è¿”å›å‡ºç°æ¬¡æ•°æœ€å¤šçš„label
</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">classify0</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">group</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'B'
</code></pre></div></div>

<h2 id="åˆ©ç”¨k-è¿‘é‚»ç®—æ³•æ”¹è¿›çº¦ä¼šç½‘ç«™é…å¯¹æ•ˆæœ">åˆ©ç”¨k-è¿‘é‚»ç®—æ³•æ”¹è¿›çº¦ä¼šç½‘ç«™é…å¯¹æ•ˆæœ</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'font.sans-serif'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'SimHei'</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'axes.unicode_minus'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

</code></pre></div></div>

<h3 id="æ•°æ®è¯»å–">æ•°æ®è¯»å–</h3>

<h4 id="æ–‡ä»¶æ ¼å¼å¤„ç†">æ–‡ä»¶æ ¼å¼å¤„ç†</h4>

<p>ç”±äºåŸå§‹çš„æ•°æ®æ–‡ä»¶æ˜¯.txtç±»å‹æ–‡ä»¶ï¼Œæ•°æ®ä¹‹é—´ç”¨â€™\tâ€™åˆ†éš”ï¼Œäºæ˜¯å°†å…¶è¯»å–å¤„ç†åå­˜ä¸º.csvæ–‡ä»¶ä¾¿äºæ•°æ®æ“ä½œ</p>

<p>txt2csvå‡½æ•°å°†.txtæ–‡ä»¶è½¬åŒ–ä¸º.csvæ–‡ä»¶</p>

<p>å‚æ•°ï¼šfileName:æ–‡ä»¶åï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰ï¼Œcolumns:æ•°æ®æ‰€å¯¹åº”çš„åˆ—åç»„æˆçš„åˆ—è¡¨</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">txt2csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>

    <span class="c1"># æ‰“å¼€æ–‡ä»¶æŒ‰è¡Œè¯»å–
</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># å°†æ¯ä¸€è¡Œæ•°æ®é—´éš”æ–¹å¼ç”±'\t'æ”¹ä¸º','
</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

        <span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span> <span class="s">','</span><span class="p">)</span>

    <span class="c1"># å°†åˆ—åæ’å…¥æ•°æ®å¤´éƒ¨
</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span>

    <span class="n">content</span> <span class="o">+=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># å­˜å‚¨ä¿®æ”¹åçš„æ•°æ®ä¸º.csvæ–‡ä»¶
</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">'.csv'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">txt2csv</span><span class="p">(</span><span class="s">'data/datingTestSet.txt'</span><span class="p">,</span> <span class="p">[</span><span class="s">'æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°'</span><span class="p">,</span><span class="s">'ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”'</span><span class="p">,</span><span class="s">'æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°'</span><span class="p">,</span><span class="s">'è¯„ä»·'</span><span class="p">])</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/datingTestSet.csv'</span><span class="p">)</span>

</code></pre></div></div>

<h4 id="æ–‡ä»¶è¯»å–">æ–‡ä»¶è¯»å–</h4>

<p>è¯»å–è®­ç»ƒæ•°æ®æ–‡ä»¶</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">splitData</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>

    <span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">datingDataMat</span><span class="p">,</span> <span class="n">datingLabels</span> <span class="o">=</span> <span class="n">splitData</span><span class="p">(</span><span class="s">'data/datingTestSet.csv'</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/datingTestSet.csv'</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="æ•°æ®åˆ†æ">æ•°æ®åˆ†æ</h3>

<p>åˆ†æâ€œç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”â€ä¸â€œæ¯å‘¨æ‰€æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°â€çš„å…³ç³»</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">"æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s">"è¯„ä»·"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1e58fe9a400&gt;
</code></pre></div></div>

<p><img src="/media/editor/output_29_1_20190325181740236162.png" alt="" /></p>

<p>è§‚å¯Ÿå„ä¸ªç‰¹å¾ä¹‹é—´çš„å…³ç³»</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s">"è¯„ä»·"</span><span class="p">,</span> <span class="n">plot_kws</span><span class="o">=</span><span class="p">{</span><span class="s">'alpha'</span><span class="p">:</span><span class="mf">0.3</span><span class="p">})</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;seaborn.axisgrid.PairGrid at 0x1e591194748&gt;
</code></pre></div></div>

<p><img src="/media/editor/output_31_2_20190325181753333190.png" alt="" /></p>

<h3 id="æ•°æ®é¢„å¤„ç†">æ•°æ®é¢„å¤„ç†</h3>

<p>ç”±äºç»™å‡ºçš„ä¸‰åˆ—ç‰¹å¾å–å€¼èŒƒå›´ä¸åŒï¼Œé¦–å…ˆå°†å®ƒä»¬çš„æ•°å€¼å½’ä¸€åŒ–</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">autoNorm</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>

    <span class="n">minVals</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="nb">min</span><span class="p">()</span>

    <span class="n">maxVals</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">dataSet</span> <span class="o">-</span> <span class="n">minVals</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxVals</span> <span class="o">-</span> <span class="n">minVals</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">df</span><span class="p">[</span><span class="s">'æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°'</span><span class="p">]</span> <span class="o">=</span> <span class="n">autoNorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°'</span><span class="p">])</span>

<span class="n">df</span><span class="p">[</span><span class="s">'ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”'</span><span class="p">]</span> <span class="o">=</span> <span class="n">autoNorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”'</span><span class="p">])</span>

<span class="n">df</span><span class="p">[</span><span class="s">'æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°'</span><span class="p">]</span> <span class="o">=</span> <span class="n">autoNorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°'</span><span class="p">])</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

</code></pre></div></div>

<h3 id="åˆ†ç±»">åˆ†ç±»</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">datingLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

</code></pre></div></div>

<p>å®šä¹‰ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰å¤„ç†æ­¥éª¤çš„å‡½æ•°ä½œä¸ºåˆ†ç±»å™¨</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">datingClassTest</span><span class="p">():</span>

    <span class="c1"># æ–‡ä»¶å¤„ç†
</span>
    <span class="n">txt2csv</span><span class="p">(</span><span class="s">'data/datingTestSet.txt'</span><span class="p">,</span> <span class="p">[</span><span class="s">'æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°'</span><span class="p">,</span><span class="s">'ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”'</span><span class="p">,</span><span class="s">'æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°'</span><span class="p">,</span><span class="s">'è¯„ä»·'</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/datingTestSet.csv'</span><span class="p">)</span>

    <span class="c1"># æ•°æ®é¢„å¤„ç†-å½’ä¸€åŒ–
</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°'</span><span class="p">]</span> <span class="o">=</span> <span class="n">autoNorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'æ¯å¹´è·å¾—çš„é£è¡Œå¸¸å®¢é‡Œç¨‹æ•°'</span><span class="p">])</span>

    <span class="n">df</span><span class="p">[</span><span class="s">'ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”'</span><span class="p">]</span> <span class="o">=</span> <span class="n">autoNorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'ç©è§†é¢‘æ¸¸æˆæ‰€è€—æ—¶é—´ç™¾åˆ†æ¯”'</span><span class="p">])</span>

    <span class="n">df</span><span class="p">[</span><span class="s">'æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°'</span><span class="p">]</span> <span class="o">=</span> <span class="n">autoNorm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'æ¯å‘¨æ¶ˆè´¹çš„å†°æ·‡æ·‹å…¬å‡æ•°'</span><span class="p">])</span>

    <span class="c1"># æ•°æ®æ‹†åˆ†
</span>
    <span class="n">datingDataMat</span><span class="p">,</span> <span class="n">datingLabels</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># æµ‹è¯•
</span>
    <span class="n">test_ratio</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># æµ‹è¯•é›†æ¯”ä¾‹
</span>
    <span class="n">test_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">test_ratio</span><span class="p">)</span>  <span class="c1"># æµ‹è¯•é›†å¤§å°
</span>
    <span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># åˆ†ç±»é”™è¯¯ä¸ªæ•°ç»Ÿè®¡
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_length</span><span class="p">):</span>

        <span class="c1"># è¿™é‡Œä¹‹å‰ç”¨çš„æ˜¯pandas.DataFrameæ•°æ®ç±»å‹ï¼Œè€Œåˆ†ç±»å‡½æ•°ä¸­ç”¨çš„æ˜¯numpy.arrayç±»å‹ï¼Œæ‰€ä»¥è¦è½¬åŒ–ä¸€ä¸‹
</span>
        <span class="n">input_X</span> <span class="o">=</span> <span class="n">datingDataMat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">dataSet</span> <span class="o">=</span> <span class="n">datingDataMat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_length</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="n">datingLabels</span><span class="p">[</span><span class="n">test_length</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">classifierResult</span> <span class="o">=</span> <span class="n">classify0</span><span class="p">(</span><span class="n">input_X</span><span class="p">,</span> <span class="n">dataSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"the classifier came back with:</span><span class="si">%</span><span class="s">s, the real answer is:</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">classifierResult</span><span class="p">,</span> <span class="n">datingLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">classifierResult</span> <span class="o">!=</span> <span class="n">datingLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>

            <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"the total error rate is : </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_count</span><span class="o">/</span><span class="n">test_length</span><span class="p">))</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">datingClassTest</span><span class="p">()</span>

</code></pre></div></div>

<p>å¯è§é”™è¯¯ç‡ä¸º0.05ï¼Œæ­£ç¡®ç‡æœ‰95%ï¼Œæ¯”è¾ƒä»¤äººæ»¡æ„</p>

<p>å¦‚æœè¦æ ¹æ®å·²æœ‰ç»“æœè¿›è¡Œé¢„æµ‹ï¼Œæµ‹è°ƒç”¨åˆ†ç±»å‡½æ•°ï¼Œå°†å½“å‰æ‰€æœ‰çš„æ•°æ®ä½œä¸ºdataSetå‚æ•°å³å¯</p>

<h2 id="æ‰‹å†™è¯†åˆ«ç³»ç»Ÿ">æ‰‹å†™è¯†åˆ«ç³»ç»Ÿ</h2>

<h3 id="å‡†å¤‡æ•°æ®">å‡†å¤‡æ•°æ®</h3>

<p>ä¸ºäº†ä¾¿äºæ“ä½œï¼Œéœ€è¦å°†æ‰‹å†™æ•°å­—çš„å›¾ç‰‡éƒ½è½¬åŒ–ä¸º0ï¼Œ1çŸ©é˜µè¡¨ç¤ºçš„æ–‡æœ¬</p>

<p>ç”±äºå›¾ç‰‡å·²ç»äº‹å…ˆè½¬æ¢å®Œæˆï¼Œäºæ˜¯åªå†™è¯»å–txtæ–‡æœ¬ä¸­çŸ©é˜µåˆ°numpyçš„å‡½æ•°</p>

<p>img2vectorå‡½æ•°å°†è¯»å–çš„txtæ–‡ä»¶ä¸­æ ¼å¼ä¸º32*32çš„0-1çŸ©é˜µè¯»å–åˆ°numpyæ•°ç»„ä¸­åï¼Œå°†å…¶è½¬åŒ–ä¸ºä¸€ä¸ªé•¿ä¸º1024çš„æ•°ç»„</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">img2vector</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>

    <span class="c1"># è¯»å–æ–‡ä»¶
</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

    <span class="c1"># å¤„ç†æ•°æ®ï¼Œå°†å­—ç¬¦å‹è½¬åŒ–ä¸ºæ•´å‹
</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">lines</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>

            <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span>

    <span class="c1"># å°†çŸ©é˜µè½¬åŒ–ä¸ºæ•°ç»„
</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1024</span><span class="p">)</span>

    

    <span class="k">return</span> <span class="n">data</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">img2vector</span><span class="p">(</span><span class="s">'data/digits/trainingDigits/0_0.txt'</span><span class="p">)</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[0, 0, 0, ..., 0, 0, 0]])
</code></pre></div></div>

<h3 id="æ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿ">æ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">os</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">handwritingClassTest</span><span class="p">():</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># å­˜å‚¨æ•°æ®æ ‡ç­¾çš„åˆ—è¡¨
</span>
    <span class="n">trainingFileList</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'data/digits/trainingDigits'</span><span class="p">)</span>  <span class="c1"># è·å–æ‰€æœ‰è®­ç»ƒæ•°æ®æ–‡ä»¶åˆ—è¡¨
</span>
    <span class="n">hight</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainingFileList</span><span class="p">)</span>  <span class="c1"># è®­ç»ƒæ•°æ®ä¸ªæ•°
</span>
    <span class="n">trainingMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">hight</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>  <span class="c1"># å­˜å‚¨æ‰€æœ‰è®­ç»ƒæ•°æ®
</span>
    <span class="c1"># è¯»å–å¹¶å­˜å‚¨è®­ç»ƒæ•°æ®
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hight</span><span class="p">):</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="n">trainingFileList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'_'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># æ ¹æ®æ–‡ä»¶åè·å–æ ‡ç­¾
</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="n">trainingMat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">img2vector</span><span class="p">(</span><span class="s">'data/digits/trainingDigits/</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">)</span>  <span class="c1"># å°†æ–‡ä»¶è½¬å­˜ä¸ºçŸ©é˜µ
</span>
    

    <span class="c1"># æµ‹è¯•æ•°æ®
</span>
    <span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># åˆ†ç±»é”™è¯¯è®¡æ•°
</span>
    <span class="n">testFileList</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'data/digits/testDigits'</span><span class="p">)</span>  <span class="c1"># è·å–æ‰€æœ‰æµ‹è¯•æ•°æ®æ–‡ä»¶åˆ—è¡¨
</span>
    <span class="n">hight_test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">testFileList</span><span class="p">)</span>  <span class="c1"># æµ‹è¯•æ•°æ®ä¸ªæ•°
</span>
    <span class="c1"># è¯»å–å¹¶å­˜å‚¨æµ‹è¯•æ•°æ®
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hight_test</span><span class="p">):</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="n">testFileList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'_'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># æ ¹æ®æ–‡ä»¶åè·å–æ ‡ç­¾
</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">img2vector</span><span class="p">(</span><span class="s">'data/digits/trainingDigits/</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">)</span>  <span class="c1"># å°†æ–‡ä»¶è½¬å­˜ä¸ºçŸ©é˜µ
</span>
        <span class="n">classifierResult</span> <span class="o">=</span> <span class="n">classify0</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">trainingMat</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># ä½¿ç”¨k-è¿‘é‚»ç®—æ³•é¢„æµ‹å…¶ç±»åˆ«
</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"the classifier came back with: </span><span class="si">%</span><span class="s">d, the real answer is: </span><span class="si">%</span><span class="s">d"</span> <span class="o">%</span> <span class="p">(</span><span class="n">classifierResult</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">classifierResult</span><span class="o">!=</span> <span class="n">label</span><span class="p">:</span>

            <span class="n">error_count</span> <span class="o">+=</span> <span class="mi">1</span>

    

    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">the total number of errors is: </span><span class="si">%</span><span class="s">d"</span> <span class="o">%</span> <span class="n">error_count</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"the total error rate is: </span><span class="si">%</span><span class="s">f"</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_count</span><span class="o">/</span><span class="n">hight_test</span><span class="p">))</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">handwritingClassTest</span><span class="p">()</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the classifier came back with: 0, the real answer is: 0

the classifier came back with: 0, the real answer is: 0

the classifier came back with: 0, the real answer is: 0

the classifier came back with: 0, the real answer is: 0



...



the classifier came back with: 9, the real answer is: 9

the classifier came back with: 9, the real answer is: 9

the classifier came back with: 9, the real answer is: 9

the classifier came back with: 9, the real answer is: 9



the total number of errors is: 13

the total error rate is: 0.013742
</code></pre></div></div>

<p>é”™è¯¯æ€»é‡ä¸º13ä¸ªï¼Œé”™è¯¯ç‡ä¸º0.013742ï¼Œæ¯”è¾ƒä»¤äººæ»¡æ„ã€‚</p>
:ET