I"º´<h2 id="ç”¨çº¿æ€§å›å½’æ‰¾åˆ°æœ€ä½³æ‹Ÿåˆç›´çº¿">ç”¨çº¿æ€§å›å½’æ‰¾åˆ°æœ€ä½³æ‹Ÿåˆç›´çº¿</h2>

<h3 id="ç†è®º">ç†è®º</h3>

<p>å°†é¢„æµ‹ç›®æ ‡è¡¨ç¤ºä¸ºç”±ç‰¹å¾ç»„æˆçš„çº¿æ€§å›å½’æ–¹ç¨‹ï¼Œæ¯ä¸ªç‰¹å¾å¯¹åº”ä¸€ä¸ªç³»æ•°ã€‚å½“æœ‰æ–°æ•°æ®è¾“å…¥æ—¶å°†æ–°æ•°æ®çš„ç‰¹å¾ä¹˜ä¸Šå¯¹åº”çš„ç³»æ•°æ±‚å’Œå¾—åˆ°æœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚</p>

<p>é€šè¿‡ä¸æ–­è°ƒæ•´ç³»æ•°å‘é‡ï¼Œä½¿é¢„æµ‹ç»“æœä¸å®é™…å€¼çš„è¯¯å·®å°½é‡å°ï¼Œæœ€ç»ˆå¾—åˆ°æœ€ä¼˜ç³»æ•°ã€‚</p>

<p>è®¡ç®—è¯¯å·®çš„å¸¸ç”¨æ–¹æ³•ä¸ºè®¡ç®—å¹³æ–¹è¯¯å·®ï¼š<img src="http://latex.codecogs.com/gif.latex?%5Csum%5Em_%7Bi%3D1%7D%28y_i-x_i%5ETw%29%5E2" />ï¼Œå¯ç”¨çŸ©é˜µè¡¨ç¤ºä¸º<img src="http://latex.codecogs.com/gif.latex?%28y-Xw%29%5ET%28y-Xw%29" />ã€‚
å½“çŸ©é˜µXå¯ä»¥æ±‚é€†æ—¶ï¼Œå°†å‡æ–¹å·®å…¬å¼æ±‚å¯¼å¯ä»¥å¾—å‡ºå…¬å¼ï¼š<img src="http://latex.codecogs.com/gif.latex?%5Cwidehat%7Bw%7D%20%3D%20%28X%5ETX%29%5E%7B-1%7DX%5ETy" />ï¼Œå¯ä»¥æ ¹æ®å…¬å¼ä¼°è®¡wçš„æœ€ä¼˜è§£ã€‚è¿™å°±æ˜¯æœ€å°äºŒä¹˜æ³•ã€‚</p>

<h3 id="ç®—æ³•å®ç°">ç®—æ³•å®ç°</h3>

<h4 id="è½½å…¥æ•°æ®">è½½å…¥æ•°æ®</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">loadDataSet</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">dataMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">)</span>
        <span class="n">dataMat</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s">'float'</span><span class="p">)</span>
        <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">dataMat</span><span class="p">,</span> <span class="n">labels</span>
</code></pre></div></div>

<h4 id="è®¡ç®—æœ€ä½³æ‹Ÿåˆç›´çº¿">è®¡ç®—æœ€ä½³æ‹Ÿåˆç›´çº¿</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">standRegres</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">):</span>
    <span class="n">yMat</span> <span class="o">=</span> <span class="n">yArr</span><span class="o">.</span><span class="n">T</span>
    <span class="n">xTx</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">xMat</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">xTx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># çŸ©é˜µæ— æ³•æ±‚é€†
</span>        <span class="k">print</span><span class="p">(</span><span class="s">"This matrix is singular, cannot do inverse."</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">xTx</span><span class="o">.</span><span class="n">I</span> <span class="o">@</span> <span class="n">xMat</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">yMat</span>
    <span class="k">return</span> <span class="n">w</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span> <span class="o">=</span> <span class="n">loadDataSet</span><span class="p">(</span><span class="s">'data/ex0.txt'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">standRegres</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matrix([[3.00774324],
        [1.69532264]])
</code></pre></div></div>

<h4 id="ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿">ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plotRegresLine</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yMat</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xMat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yMat</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># å°†Xå’ŒYé™ç»´æˆä¸€ä½æ•°ç»„åç»˜åˆ¶æ•£ç‚¹å›¾
</span>    <span class="c1"># å°†Xæ’åºåç»˜åˆ¶é¢„æµ‹ç›´çº¿
</span>    <span class="n">xCopy</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">xCopy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yHat</span> <span class="o">=</span> <span class="n">xCopy</span> <span class="o">@</span> <span class="n">w</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xCopy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">yHat</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wHat</span> <span class="o">=</span> <span class="n">standRegres</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">)</span>
<span class="n">plotRegresLine</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="n">wHat</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/media/editor/output_17_0_20190401234014801681.png" alt="" /></p>

<p>å¯ä»¥é€šè¿‡é¢„æµ‹ç»“æœå’Œå®é™…å€¼çš„ç›¸å…³ç³»æ•°æ¥åˆ¤æ–­æ¨¡å‹çš„é¢„æµ‹æ•ˆæœã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yHat</span> <span class="o">=</span> <span class="n">xMat</span> <span class="o">@</span> <span class="n">wHat</span>
<span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">yHat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">yArr</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[1.        , 0.98647356],
       [0.98647356, 1.        ]])
</code></pre></div></div>

<p>å¯è§åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­é¢„æµ‹å€¼å’Œå®é™…å€¼ç›¸å…³ç³»æ•°ä¸º0.987,æ¨¡å‹è¡¨ç°æ•ˆæœè¾ƒå¥½ã€‚</p>

<h2 id="å±€éƒ¨åŠ æƒçº¿æ€§å›å½’">å±€éƒ¨åŠ æƒçº¿æ€§å›å½’</h2>

<h3 id="ç†è®º-1">ç†è®º</h3>

<p>çº¿æ€§å›å½’çš„å¾ˆå®¹æ˜“å‡ºç°æ¬ æ‹Ÿåˆç°è±¡ï¼Œå› ä¸ºå®ƒæ±‚çš„æ˜¯å…·æœ‰æœ€å°å‡æ–¹è¯¯å·®çš„æ— åä¼°è®¡ã€‚å¦‚æœå…è®¸åœ¨ä¼°è®¡æ—¶å¼•å…¥ä¸€äº›åå·®ï¼Œå¯èƒ½å¯ä»¥é™ä½é¢„æµ‹çš„å‡æ–¹è¯¯å·®ã€‚å…¶ä¸­ä¸€ä¸ªæ–¹æ³•å°±æ˜¯å±€éƒ¨åŠ æƒçº¿æ€§å›å½’ã€‚</p>

<p>è¿™ä¸ªæ–¹æ³•ä¸KNNç›¸ä¼¼ï¼Œæ¯æ¬¡é¢„æµ‹æ—¶å–å‡ºç›®æ ‡é¢„æµ‹ç‚¹é™„è¿‘çš„æ•°æ®å­é›†ï¼Œç»™æ•°æ®å­é›†ä¸­çš„æ¯ä¸ªç‚¹èµ‹äºˆä¸€å®šçš„æƒé‡ç„¶ååŸºäºæœ€å°å‡æ–¹å·®æ¥è¿›è¡Œæ™®é€šçš„å›å½’ã€‚</p>

<p>å›å½’ç³»æ•°çš„è®¡ç®—å…¬å¼ï¼š<img src="http://latex.codecogs.com/gif.latex?%5Cwidehat%7Bw%7D%20%3D%20%28X%5ETWX%29%5E%7B-1%7DX%5ETWy" />ï¼Œå…¶ä¸­Wæ˜¯æƒé‡çŸ©é˜µ</p>

<p>å±€éƒ¨åŠ æƒçº¿æ€§å›å½’ä½¿ç”¨â€œæ ¸â€æ¥å¯¹é™„è¿‘çš„ç‚¹èµ‹äºˆæ›´é«˜çš„æƒé‡ã€‚å¸¸ç”¨é«˜æ–¯æ ¸ï¼š<img src="http://latex.codecogs.com/gif.latex?w%28i%2Ci%29%20%3D%20exp%5Cleft%28%5Cfrac%7B%5Cleft%7Cx%5E%7B%28i%29%7D-x%5Cright%7C%7D%7B-2k%5E2%7D%5Cright%29" />æ ¹æ®å…¬å¼å¯ä»¥çœ‹å‡ºï¼šç‚¹xä¸ç‚¹x(i)è¶Šè¿‘ï¼Œw(i,i)å°†ä¼šè¶Šå¤§ã€‚å…¬å¼ä¸­çš„kéœ€è¦è‡ªè¡Œè®¾ç½®ï¼Œå½“kè¶Šå°ï¼Œèƒ½ç”¨äºè®­ç»ƒå›å½’æ¨¡å‹çš„æ•°æ®é‡å°±è¶Šå°ã€‚</p>

<h3 id="ç®—æ³•å®ç°-1">ç®—æ³•å®ç°</h3>

<h4 id="åˆ©ç”¨åŠ æƒçº¿æ€§å›å½’é¢„æµ‹å•æ¡æ•°æ®">åˆ©ç”¨åŠ æƒçº¿æ€§å›å½’é¢„æµ‹å•æ¡æ•°æ®</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">lwlr</span><span class="p">(</span><span class="n">testPoint</span><span class="p">,</span> <span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">yMat</span> <span class="o">=</span> <span class="n">yArr</span><span class="o">.</span><span class="n">T</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">((</span><span class="n">m</span><span class="p">)))</span>  <span class="c1"># åˆå§‹åŒ–æƒé‡çŸ©é˜µä¸ºå•ä½çŸ©é˜µ
</span>    <span class="c1"># ä½¿ç”¨é«˜æ–¯æ ¸è®¡ç®—æƒé‡çŸ©é˜µ
</span>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">diffMat</span> <span class="o">=</span> <span class="n">testPoint</span> <span class="o">-</span> <span class="n">xMat</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
        <span class="n">weights</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">diffMat</span><span class="o">*</span><span class="n">diffMat</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1">#weights[j,j] = np.exp(np.linalg.det(diffMat) / (-2*k**2))
</span>    <span class="n">xTx</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">weights</span> <span class="o">@</span> <span class="n">xMat</span>
    <span class="c1"># çŸ©é˜µä¸å¯é€†
</span>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">xTx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"This matrix is singular, cannot do inverse."</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">xTx</span><span class="o">.</span><span class="n">I</span> <span class="o">@</span> <span class="n">xMat</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">weights</span> <span class="o">@</span> <span class="n">yMat</span>
    <span class="k">return</span> <span class="n">testPoint</span> <span class="o">@</span> <span class="n">result</span>
</code></pre></div></div>

<h4 id="åˆ©ç”¨åŠ æƒçº¿æ€§å›å½’é¢„æµ‹æ•°æ®é›†">åˆ©ç”¨åŠ æƒçº¿æ€§å›å½’é¢„æµ‹æ•°æ®é›†</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">lwlrTest</span><span class="p">(</span><span class="n">testArr</span><span class="p">,</span> <span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yHat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">yHat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lwlr</span><span class="p">(</span><span class="n">testArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yHat</span>
</code></pre></div></div>

<h4 id="ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿-1">ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plotLine</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">fig</span><span class="p">,</span><span class="n">plot_position</span><span class="p">):</span>
    <span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span> <span class="o">=</span> <span class="n">loadDataSet</span><span class="p">(</span><span class="s">'data/ex0.txt'</span><span class="p">)</span>
    <span class="n">yHat</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plot_position</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xMat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yArr</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># å°†Xå’ŒYé™ç»´æˆä¸€ä½æ•°ç»„åç»˜åˆ¶æ•£ç‚¹å›¾
</span>    <span class="c1"># å°†Xæ’åºåç»˜åˆ¶é¢„æµ‹ç›´çº¿
</span>    <span class="n">sortedIndex</span> <span class="o">=</span> <span class="n">xMat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">xCopy</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">sortedIndex</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xCopy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">yHat</span><span class="p">[</span><span class="n">sortedIndex</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plotLine</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="mi">311</span><span class="p">)</span>
<span class="n">plotLine</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="mi">312</span><span class="p">)</span>
<span class="n">plotLine</span><span class="p">(</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="mi">313</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/media/editor/output_34_0_20190401234028717750.png" alt="" /></p>

<p>å¯è§å½“kè¿‡å°æ—¶å®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆç°è±¡ï¼ŒåŸå› æ˜¯è€ƒè™‘äº†å¤ªå¤šå™ªå£°ã€‚</p>

<h2 id="ç¤ºä¾‹é¢„æµ‹é²é±¼çš„å¹´é¾„">ç¤ºä¾‹ï¼šé¢„æµ‹é²é±¼çš„å¹´é¾„</h2>

<h3 id="è¯»å–æ•°æ®">è¯»å–æ•°æ®</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">abX</span><span class="p">,</span> <span class="n">abY</span> <span class="o">=</span> <span class="n">loadDataSet</span><span class="p">(</span><span class="s">'data/abalone.txt'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="è®­ç»ƒæ¨¡å‹">è®­ç»ƒæ¨¡å‹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yHat01</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">yHat1</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">yHat10</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="è®¡ç®—è¯¯å·®">è®¡ç®—è¯¯å·®</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rssError</span><span class="p">(</span><span class="n">yArr</span><span class="p">,</span> <span class="n">yHat</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">yArr</span> <span class="o">-</span> <span class="n">yHat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<p>è®­ç»ƒæ•°æ®é›†è¯¯å·®è®¡ç®—</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rssError</span><span class="p">(</span><span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yHat01</span><span class="p">)</span>
<span class="n">rssError</span><span class="p">(</span><span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yHat1</span><span class="p">)</span>
<span class="n">rssError</span><span class="p">(</span><span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yHat10</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>56.81549669032892

429.8905618702056

549.1181708826584
</code></pre></div></div>

<p>æµ‹è¯•æ•°æ®å°†è¯¯å·®è®¡ç®—</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yHat01</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">abX</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">199</span><span class="p">,:],</span> <span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">yHat1</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">abX</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">199</span><span class="p">,:],</span> <span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">yHat10</span> <span class="o">=</span> <span class="n">lwlrTest</span><span class="p">(</span><span class="n">abX</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">199</span><span class="p">,:],</span> <span class="n">abX</span><span class="p">[:</span><span class="mi">99</span><span class="p">,:],</span> <span class="n">abY</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rssError</span><span class="p">(</span><span class="n">abY</span><span class="p">[:,</span><span class="mi">100</span><span class="p">:</span><span class="mi">199</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yHat01</span><span class="p">)</span>
<span class="n">rssError</span><span class="p">(</span><span class="n">abY</span><span class="p">[:,</span><span class="mi">100</span><span class="p">:</span><span class="mi">199</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yHat1</span><span class="p">)</span>
<span class="n">rssError</span><span class="p">(</span><span class="n">abY</span><span class="p">[:,</span><span class="mi">100</span><span class="p">:</span><span class="mi">199</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yHat10</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>40659.27596541478

573.5261441898057

517.5711905382693
</code></pre></div></div>

<p>å¯è§kè¶Šå°åœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°è¶Šå¥½ï¼Œä½†æ˜¯è¿‡æ‹Ÿåˆä¸¥é‡ï¼Œåœ¨æµ‹è¯•é›†ä¸Šè¡¨ç°å¾ˆå·®</p>

<h2 id="ç¼©å‡ç³»æ•°æ¥ç†è§£æ•°æ®">ç¼©å‡ç³»æ•°æ¥â€œç†è§£â€æ•°æ®</h2>

<p>å½“æ•°æ®çš„ç‰¹å¾æ¯”æ ·æœ¬ç‚¹è¿˜å¤šæ—¶ï¼Œç”¨ä¹‹å‰çš„æœ€å°äºŒä¹˜æ³•æ±‚ç³»æ•°çŸ©é˜µæ—¶ç”±äºXä¸æ˜¯æ»¡ç§©çŸ©é˜µï¼Œåœ¨æ±‚é€†æ—¶ä¼šå‡ºç°é—®é¢˜ï¼Œå› æ­¤å¼•å…¥äº†æ¥ä¸‹æ¥çš„æ–¹æ³•ã€‚</p>

<h3 id="å²­å›å½’">å²­å›å½’</h3>

<h4 id="ç†è®º-2">ç†è®º</h4>

<p>ç®€å•æ¥è¯´ï¼Œå²­å›å½’å°±æ˜¯åœ¨çŸ©é˜µ$X^TX$ä¸ŠåŠ å…¥ä¸€ä¸ª<img src="http://latex.codecogs.com/gif.latex?%24%5Clambda%20I%24" />ä½¿å¾—çŸ©é˜µéå¥‡å¼‚ï¼Œä»è€Œå¯ä»¥è¿›è¡Œæ±‚é€†è¿ç®—ã€‚çŸ©é˜µIæ˜¯ä¸€ä¸ªmxmçš„å•ä½çŸ©é˜µï¼ŒÎ»çš„æ•°å€¼ç”±ç”¨æˆ·è‡ªè¡Œè®¾ç½®ã€‚</p>

<p>å› æ­¤ï¼Œå›å½’ç³»æ•°è®¡ç®—å…¬å¼å˜ä¸ºï¼š<img src="http://latex.codecogs.com/gif.latex?%5Cwidehat%7Bw%7D%20%3D%20%28X%5ETX&plus;%5Clambda%20I%29%5E%7B-1%7DX%5ETy" /></p>

<p>å²­å›å½’æœ€åˆç”¨æ¥å¤„ç†ç‰¹å¾æ•°å¤šä½™æ ·æœ¬æ•°çš„æƒ…å†µï¼Œç°åœ¨ä¹Ÿç”¨äºåœ¨ä¼°è®¡ä¸­åŠ å…¥åå·®ä»è€Œè·å¾—æ›´å¥½çš„ä¼°è®¡ã€‚å¼•å…¥çš„Î»ä½œä¸ºæƒ©ç½šé¡¹èƒ½å¤Ÿå‡å°‘ä¸é‡è¦çš„å‚æ•°ã€‚</p>

<p>ä¸ä¹‹å‰ç›¸åŒï¼Œé€šè¿‡é¢„æµ‹è¯¯å·®æœ€å°åŒ–æ±‚å¾—Î»ã€‚</p>

<h4 id="ç®—æ³•å®ç°-2">ç®—æ³•å®ç°</h4>

<h5 id="æ±‚å›å½’ç³»æ•°">æ±‚å›å½’ç³»æ•°</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ridgeRegress</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yMat</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="n">xTx</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">xMat</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">xTx</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">lam</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"This matrix is singular, cannot do inverse"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">I</span> <span class="o">@</span> <span class="n">xMat</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">yMat</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h5 id="å²­å›å½’é¢„æµ‹">å²­å›å½’é¢„æµ‹</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ridgeTest</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">):</span>
    <span class="n">yMat</span> <span class="o">=</span> <span class="n">yArr</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># æ•°æ®æ ‡å‡†åŒ–
</span>    <span class="n">yMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yMat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">yMat</span> <span class="o">=</span> <span class="n">yMat</span> <span class="o">-</span> <span class="n">yMean</span>
    <span class="n">xMeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">xVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">xMat</span> <span class="o">=</span> <span class="p">(</span><span class="n">xMat</span> <span class="o">-</span> <span class="n">xMeans</span><span class="p">)</span> <span class="o">/</span> <span class="n">xVar</span>
    
    <span class="n">numTestPts</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># æµ‹è¯•çš„Î»ä¸ªæ•°
</span>    <span class="n">wMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numTestPts</span><span class="p">,</span><span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># å­˜å‚¨æ‰€æœ‰Î»å¯¹åº”çš„å›å½’ç³»æ•°
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numTestPts</span><span class="p">):</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">ridgeRegress</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yMat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">wMat</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">return</span> <span class="n">wMat</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">abX</span><span class="p">,</span> <span class="n">abY</span> <span class="o">=</span> <span class="n">loadDataSet</span><span class="p">(</span><span class="s">'data/abalone.txt'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ridgeWeights</span> <span class="o">=</span> <span class="n">ridgeTest</span><span class="p">(</span><span class="n">abX</span><span class="p">,</span> <span class="n">abY</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="ä¸åŒlambdaæ¨¡å‹æ•ˆæœæ¯”è¾ƒ">ä¸åŒlambdaæ¨¡å‹æ•ˆæœæ¯”è¾ƒ</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ridgeWeights</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"log(Î»)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/media/editor/output_65_2_20190401234053872011.png" alt="" /></p>

<h3 id="lasso">lasso</h3>

<p>ä¸å²­å›å½’ç±»ä¼¼ï¼Œlassoä¹Ÿå¯¹å›å½’ç³»æ•°åšäº†é™å®šï¼š<img src="http://latex.codecogs.com/gif.latex?%5Csum%5En_%7Bk%3D1%7D%5Cleft%7Cw_k%5Cright%7C%5Cleqslant%5Clambda" /></p>

<p>é€šè¿‡è¿™ä¸ªé™åˆ¶æ¡ä»¶ï¼Œå½“Î»è¶³å¤Ÿå°çš„æ—¶å€™ï¼Œéƒ¨åˆ†ç³»æ•°ä¼šè¢«ç¼©å‡åˆ°0ï¼Œç¼©å‡ç‰¹å¾çš„åŒæ—¶å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£æ•°æ®ã€‚</p>

<p>è™½ç„¶æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯æå¤§åœ°å¢åŠ äº†è®¡ç®—å¤æ‚åº¦ã€‚ä¸‹é¢çš„æ–¹æ³•æ›´ä¸ºç®€å•ã€‚</p>

<h3 id="å‰å‘é€æ­¥å›å½’">å‰å‘é€æ­¥å›å½’</h3>

<h4 id="ç†è®º-3">ç†è®º</h4>

<p>å‰å‘é€æ­¥å›å½’å¯ä»¥å¾—åˆ°ä¸lassoå·®ä¸å¤šçš„æ•ˆæœä½†æ›´åŠ ç®€å•ã€‚å®ƒå±äºä¸€ç§è´ªå¿ƒç®—æ³•å³æ¯ä¸€æ­¥éƒ½å°½å¯èƒ½å‡å°è¯¯å·®ã€‚åˆå§‹æ—¶æ‰€æœ‰æƒé‡ä¸º1ï¼Œæ¯ä¸€æ­¥æ‰€åšçš„å†³ç­–æ˜¯å¯¹æŸä¸ªæƒé‡å¢åŠ æˆ–å‡å°‘ä¸€ä¸ªå¾ˆå°çš„å€¼</p>

<h4 id="ç®—æ³•å®ç°-3">ç®—æ³•å®ç°</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">regularize</span><span class="p">(</span><span class="n">xMat</span><span class="p">):</span>
    <span class="n">inMat</span> <span class="o">=</span> <span class="n">xMat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">inMeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">inMat</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">inVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">inMat</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">inMat</span> <span class="o">=</span> <span class="p">(</span><span class="n">inMat</span> <span class="o">-</span> <span class="n">inMeans</span><span class="p">)</span><span class="o">/</span><span class="n">inVar</span>
    <span class="k">return</span> <span class="n">inMat</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">stageWise</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">numIt</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="s">"""
    eps: æƒé‡æ¯æ¬¡æ”¹å˜çš„æ­¥é•¿
    numIt: è¿­ä»£æ¬¡æ•°
    """</span>
    <span class="n">yMat</span> <span class="o">=</span> <span class="n">yArr</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># æ•°æ®æ ‡å‡†åŒ–
</span>    <span class="n">yMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yMat</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yMat</span> <span class="o">=</span> <span class="n">yMat</span> <span class="o">-</span> <span class="n">yMean</span>
    <span class="n">xMat</span> <span class="o">=</span> <span class="n">regularize</span><span class="p">(</span><span class="n">xMat</span><span class="p">)</span>
    <span class="c1"># å‰å‘é€æ­¥å›å½’
</span>    <span class="n">returnMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numIt</span><span class="p">,</span><span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numIt</span><span class="p">):</span>
        <span class="c1">#print(ws.T)
</span>        <span class="n">wsMax</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lowestError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># åˆå§‹åŒ–æœ€å°è¯¯å·®ä¸ºæ— ç©·å¤§
</span>        <span class="c1"># é€æ­¥ä¿®æ”¹æ¯ä¸ªç‰¹å¾çš„æƒé‡
</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xMat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># æƒé‡å¢æˆ–å‡
</span>            <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">wsTest</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">wsTest</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">sign</span>
                <span class="n">yTest</span> <span class="o">=</span> <span class="n">xMat</span> <span class="o">@</span> <span class="n">wsTest</span>
                <span class="c1"># è®¡ç®—è¯¯å·®
</span>                <span class="n">rssE</span> <span class="o">=</span> <span class="n">rssError</span><span class="p">(</span><span class="n">yMat</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">yTest</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rssE</span> <span class="o">&lt;</span> <span class="n">lowestError</span><span class="p">:</span>
                    <span class="n">lowestError</span> <span class="o">=</span> <span class="n">rssE</span>
                    <span class="n">wsMax</span> <span class="o">=</span> <span class="n">wsTest</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">wsMax</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">returnMat</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">returnMat</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span> <span class="o">=</span> <span class="n">loadDataSet</span><span class="p">(</span><span class="s">'data/abalone.txt'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">weights</span> <span class="o">=</span> <span class="n">stageWise</span><span class="p">(</span><span class="n">xMat</span><span class="p">,</span> <span class="n">yArr</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/media/editor/output_77_1_20190402122318183132.png" alt="" /></p>

<p>å¯è§å½“è¿­ä»£æ¬¡æ•°åˆ°è¾¾600åï¼Œæƒé‡è¶‹è¿‘äºä¸€ä¸ªç¨³å®šå€¼ã€‚è¿™æ ·çš„å›¾åƒå……åˆ†ä½“ç°äº†æ¨¡å‹çš„å¥½å¤„ã€‚</p>
:ET