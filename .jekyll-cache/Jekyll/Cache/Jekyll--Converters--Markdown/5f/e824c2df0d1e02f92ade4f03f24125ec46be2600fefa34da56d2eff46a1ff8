I"…~<h1 id="urllibåº“">urllibåº“</h1>
<h3 id="1å¯¼å…¥å¯¹åº”æ¨¡å—">1.å¯¼å…¥å¯¹åº”æ¨¡å—ï¼š</h3>
<p>å› ä¸ºPython 3.*ç‰ˆæœ¬ä¸­å°†urllibå’Œurllib2åˆå¹¶ä¸ºurllibï¼Œæ‰€ä»¥ç›´æ¥</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>
</code></pre></div></div>

<h3 id="2ä½¿ç”¨-urllibrequesturlopenurlæ‰“å¼€å¹¶çˆ¬å–ä¸€ä¸ªç½‘é¡µ">2.ä½¿ç”¨ urllib.request.urlopen(url)æ‰“å¼€å¹¶çˆ¬å–ä¸€ä¸ªç½‘é¡µ</h3>
<p>è¿™é‡Œå°†ç™¾åº¦ä½œä¸ºä¾‹å­</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3å°†å¯¹åº”ç½‘é¡µçš„å†…å®¹è¯»å–å‡ºæ¥">3.å°†å¯¹åº”ç½‘é¡µçš„å†…å®¹è¯»å–å‡ºæ¥</h3>
<p>è¯»å–å†…å®¹çš„å¸¸è§æ–¹å¼æœ‰3ç§ï¼š</p>
<ol>
  <li>a. file.read() è¯»å–æ–‡ä»¶å…¨éƒ¨å†…å®¹ï¼ŒæŠŠè¯»å–åˆ°çš„å†…å®¹èµ‹ç»™ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼›</li>
  <li>b. file.readlines() è¯»å–æ–‡ä»¶å…¨éƒ¨å†…å®¹ï¼ŒæŠŠè¯»å–åˆ°çš„å†…å®¹èµ‹ç»™ä¸€ä¸ªåˆ—è¡¨å˜é‡ï¼Œè‹¥è¦è¯»å–å…¨éƒ¨å†…å®¹ï¼Œæ¨èè¿™ç§æ–¹å¼ï¼›</li>
  <li>c. file.readline() è¯»å–æ–‡ä»¶çš„ä¸€è¡Œå†…å®¹ã€‚</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">dataline</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>
</code></pre></div></div>

<p>è¿™é‡Œåˆ†åˆ«å°†çˆ¬å–çš„ç½‘é¡µçš„å…¨éƒ¨å†…å®¹å’Œä¸€è¡Œå†…å®¹åˆ†åˆ«èµ‹ç»™å˜é‡data, dataline
è‹¥æƒ³è¾“å‡ºçˆ¬å–åˆ°çš„å†…å®¹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨print() :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">dataline</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4ä¿å­˜çˆ¬å–çš„ç½‘é¡µå†…å®¹">4.ä¿å­˜çˆ¬å–çš„ç½‘é¡µå†…å®¹</h3>
<p>æ­¥éª¤ï¼š</p>
<ol>
  <li>çˆ¬å–ä¸€ä¸ªç½‘ç«™è¯»å–å‡ºæ¥å¹¶èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼›</li>
  <li>ä»¥å†™å…¥çš„æ–¹å¼æ‰“å¼€ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼Œä½¿ç”¨ .htmlåç¼€ï¼›</li>
  <li>å°†aä¸­çš„å˜é‡çš„å€¼å†™å…¥æ–‡ä»¶ï¼›</li>
  <li>å…³é—­æ–‡ä»¶</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"D:/Python/test.html"</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>æˆ–</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"D:/Python/test.html"</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<p>æ­¤å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ç›´æ¥å†™å…¥æ–‡ä»¶ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">"D:/Python/test.html"</span><span class="p">)</span>
</code></pre></div></div>

<p>å¯ä»¥ä½¿ç”¨ç”¨ urllib.request.cleanup()æ¸…ç©ºä½¿ç”¨urlretrieveäº§ç”Ÿçš„ç¼“å­˜ã€‚</p>

<h3 id="5å…¶ä»–">5.å…¶ä»–</h3>
<ol>
  <li>ä½¿ç”¨ request.getcode() å¯ä»¥è¿”å›çˆ¬å–ç½‘é¡µçš„çŠ¶æ€ç ï¼Œè‹¥ä¸º200åˆ™çˆ¬å–æ­£å¸¸;</li>
  <li>ä½¿ç”¨ request.geturl()è¿”å›çˆ¬å–ç½‘é¡µçš„url;</li>
  <li>
    <p>ä¸€èˆ¬æ¥è¯´ï¼ŒURLæ ‡å‡†ä¸­åªä¼šå…è®¸ä¸€éƒ¨åˆ†ASCâ…¡å­—ç¬¦ï¼Œè‹¥è¦åœ¨å…¶ä¸­ä½¿ç”¨æ±‰å­—ç­‰å…¶ä»–å­—ç¬¦ï¼Œéœ€å¯¹urlè¿›è¡Œç¼–ç </p>

    <p>è¿™é‡Œä»¥æ·˜å®ä¸ºä¾‹</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="s">"http://www.taobao.com"</span><span class="p">)</span>
 <span class="s">'http%3A//www.taobao.com'</span>
</code></pre></div>    </div>

    <p>ç›¸åº”åœ°ï¼Œå¯¹urlè¿›è¡Œè§£ç è¯—å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ“ä½œï¼š</p>

    <p>urllib.request.unquote(â€œhttp%3A//www.taobao.comâ€)
 â€˜http://www.taobao.comâ€™</p>
  </li>
</ol>

<h3 id="6æ¨¡æ‹Ÿæµè§ˆå™¨">6.æ¨¡æ‹Ÿæµè§ˆå™¨</h3>
<p>ç”¨çˆ¬è™«ç›´æ¥çˆ¬å–ç½‘é¡µæ—¶ï¼Œrequestä¸­çš„headerä¼šæ˜¾ç¤ºå…¶ä¸ºçˆ¬è™«ï¼ŒæŸäº›ç½‘é¡µä¸ºäº†é˜²æ­¢çˆ¬è™«é‡‡é›†ä¿¡æ¯ä¼šè¿›è¡Œåçˆ¬è™«è®¾ç½®ã€‚æ­¤æ—¶ä¸ºäº†æˆåŠŸçˆ¬å–è¯¥ç½‘é¡µï¼Œéœ€ä»¥æµè§ˆå™¨çš„èº«ä»½è¿›è¡Œçˆ¬å–ã€‚å› æ­¤éœ€è¦ä¿®æ”¹Headerså±æ€§â€”â€”å°†é”®â€˜user-agentâ€™çš„å€¼ä¿®æ”¹ä¸ºâ€˜Mozilla/5.0XXXXXXXXâ€™</p>
<h5 id="æ–¹æ³•ä¸€-ä½¿ç”¨-build_opnerä¿®æ”¹æŠ¥å¤´">æ–¹æ³•ä¸€ï¼š ä½¿ç”¨ build_opner()ä¿®æ”¹æŠ¥å¤´</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.baidu.com"</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">build_opener</span><span class="p">()</span>
<span class="n">opener</span><span class="p">.</span><span class="n">adddheaders</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">'User-Agent'</span><span class="p">,</span><span class="s">'Mozilla/5.0'</span><span class="p">)</span> <span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<h5 id="æ–¹æ³•äºŒ-ä½¿ç”¨-add_headersæ·»åŠ æŠ¥å¤´">æ–¹æ³•äºŒï¼š ä½¿ç”¨ add_headers()æ·»åŠ æŠ¥å¤´</h5>
<p>é¦–å…ˆä½¿ç”¨urllib.request.Request(url)åˆ›å»ºä¸€ä¸ªRequestå¯¹è±¡å¹¶èµ‹ç»™requestï¼Œç„¶åä½¿ç”¨add_header()æ·»åŠ å¯¹åº”çš„æŠ¥å¤´ä¿¡æ¯</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.baidu.com"</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">request</span><span class="p">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'User-Agent'</span><span class="p">,</span> <span class="s">'Mozilla/5.0'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>
<h5 id="æ–¹æ³•ä¸‰-ä½¿ç”¨headerså‚æ•°">æ–¹æ³•ä¸‰ï¼š ä½¿ç”¨headerså‚æ•°</h5>
<p>é¦–å…ˆæ„é€ æŠ¥å¤´ä¿¡æ¯</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.baidu.com"</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'user-agent'</span><span class="p">:</span><span class="s">'Mozilla/5.0'</span>
<span class="p">}</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="7è¶…æ—¶è®¾ç½®">7.è¶…æ—¶è®¾ç½®</h3>
<p>æœ‰æ—¶è®¿é—®ä¸€ä¸ªç½‘é¡µï¼Œå…¶é•¿æ—¶é—´æœªååº”ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­è®¿é—®è¶…æ—¶ï¼Œå¯ä»¥è‡ªå·±è®¾ç½®é™åˆ¶çš„è¶…æ—¶è®¿é—®æ—¶é—´</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"htttp://www.baidu.com"</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
</code></pre></div></div>

<p>å…¶ä¸­ï¼Œtimeoutçš„å•ä½ä¸ºç§’ã€‚
ä¾‹ä¸­è‹¥å‘ç½‘é¡µå‘é€è¯·æ±‚åæœåŠ¡å™¨åœ¨30så†…æœªå“åº”ï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">'http://www.baidu.com'</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">timeout</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'TIME OUT'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="8httpè¯·æ±‚">8.HTTPè¯·æ±‚</h3>
<p>HTTPåè®®è¯·æ±‚ä¸»è¦åˆ†ä¸º6ç±»ï¼šGETï¼ŒPOSTï¼ŒDELETEï¼ŒPUTï¼Œ HEADï¼Œ OPTIONS</p>
<h4 id="1-get-è¯·æ±‚">1). GET è¯·æ±‚</h4>
<p>åœ¨æ·˜å®ä¸Šæœç´¢Pythonåè§‚å¯Ÿå¯ä»¥å‘ç°URLç”±</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">taobao</span><span class="p">.</span><span class="n">com</span>
</code></pre></div></div>

<p>å˜ä¸ºäº†</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">s</span><span class="p">.</span><span class="n">taobao</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">search</span><span class="err">?</span><span class="n">q</span><span class="o">=</span><span class="n">Python</span><span class="o">&amp;</span><span class="n">imgfile</span><span class="o">=&amp;</span><span class="n">commend</span><span class="o">=</span><span class="nb">all</span><span class="o">&amp;</span><span class="n">ssid</span><span class="o">=</span><span class="n">s5</span><span class="o">-</span><span class="n">e</span><span class="o">&amp;</span><span class="n">search_type</span><span class="o">=</span><span class="n">item</span><span class="o">&amp;</span><span class="n">sourceId</span><span class="o">=</span><span class="n">tb</span><span class="p">.</span><span class="n">index</span><span class="o">&amp;</span><span class="n">spm</span><span class="o">=</span><span class="n">a21bo</span><span class="p">.</span><span class="mf">2017.201856</span><span class="o">-</span><span class="n">taobao</span><span class="o">-</span><span class="n">item</span><span class="p">.</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">ie</span><span class="o">=</span><span class="n">utf8</span><span class="o">&amp;</span><span class="n">initiative_id</span><span class="o">=</span><span class="n">tbindexz_20170306</span>
</code></pre></div></div>

<p>å…¶ä¸­æ‰€æœç´¢çš„â€˜Pyhtonâ€™åœ¨â€˜search?/q=â€™åã€‚ç”±æ­¤æ¨æµ‹ï¼Œå¦‚æœ</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">URL</span><span class="o">=</span> <span class="s">'htttp://s.taobao.com/search?q='</span> <span class="o">+</span> <span class="n">å…³é”®è¯</span>
</code></pre></div></div>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥çˆ¬å–æˆ‘ä»¬æƒ³è¦åœ¨æ·˜å®ä¸Šæœç´¢çš„å•†å“çš„ç½‘é¡µä¿¡æ¯ã€‚å› æ­¤å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://s.taobao.com/search?q="</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="s">"Python"</span>
<span class="n">url</span> <span class="o">+=</span> <span class="n">keyword</span> 
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"D:/Pyhton/2.html"</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>è¿™æ ·å°±ä¿å­˜äº†æ·˜å®æœç´¢å…³é”®è¯ä¸ºâ€œPythonâ€çš„ç½‘é¡µä¿¡æ¯ã€‚
å¦‚æœæœç´¢å…³é”®è¯å«ä¸­æ–‡æˆ–å…¶ä»–ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œåº”å…ˆå°†å…³é”®è¯ç¼–ç ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://s.taobao.com/search?q="</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="s">"Pythonçˆ¬è™«"</span>
<span class="n">keyword_code</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
<span class="n">url</span> <span class="o">+=</span> <span class="n">keyword_code</span>
</code></pre></div></div>

<h4 id="2postè¯·æ±‚">2).POSTè¯·æ±‚</h4>
<p>å®ç°æ€è·¯ï¼š</p>
<ol>
  <li>è®¾ç½®URLç½‘å€ï¼›</li>
  <li>æ„å»ºè¡¨å•æ•°æ®ï¼Œä½¿ç”¨urllib.parse.urlencodeå¯¹æ•°æ®è¿›è¡Œç¼–ç ï¼›</li>
  <li>åˆ›å»ºRequestå¯¹è±¡ï¼Œå‚æ•°å«URLã€è¦ä¼ é€’çš„æ•°æ®ï¼›</li>
  <li>ä½¿ç”¨urllib.request.urlopen()æ‰“å¼€Requestå¯¹è±¡ï¼›</li>
  <li>åç»­å¤„ç†ã€‚</li>
</ol>

<p>é‡ç‚¹ï¼šæ„å»ºè¡¨å•æ•°æ®å¹¶å¯¹å…¶ç¼–ç ï¼š
        æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°å¯¹åº”çš„formè¡¨å•éƒ¨åˆ†ï¼Œæ‰¾åˆ°è¾“å…¥æ¡†å±æ€§å€¼ï¼Œå°†å…¶åŒ…å«äºæ„é€ çš„æ•°æ®ä¸­ï¼Œæ ¼å¼ä¸ºå­—å…¸ï¼Œå±æ€§å€¼åœ¨å­—å…¸ä¸­å¯¹åº”çš„å€¼ä¸ºè¦ä¼ é€’çš„å€¼ã€‚</p>

<p>æ­¤å¤„ç”¨ http://www.iqianyue.com/mypost/ ä½œä¸ºä¾‹å­ï¼Œæ„å»ºè¡¨å•éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.iqianyue.com/mypost/"</span>
<span class="n">postdata</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">urlencode</span><span class="p">(</span>
<span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span><span class="s">"12345678@163.com"</span><span class="p">,</span>
    <span class="s">"password"</span><span class="p">:</span><span class="s">"Aa12345"</span>
<span class="p">}).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1">#å°†æ•°æ®å¤„ç†åè®¾ç½®ä¸ºutf-8ç¼–ç 
</span><span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">postdata</span><span class="p">)</span>
<span class="c1">#æˆ–
</span><span class="n">postdata</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">postdata</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">postdata</span><span class="p">)</span>
</code></pre></div></div>

<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://www.iqianyue.com/mypost/"</span>
<span class="n">postdata</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">urlencode</span><span class="p">(</span>
<span class="p">{</span>
    <span class="s">"name"</span><span class="p">:</span><span class="s">"123456@163.com"</span><span class="p">,</span>
    <span class="s">"password"</span><span class="p">:</span><span class="s">"Aa12345"</span>
<span class="p">}).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">postdata</span><span class="p">)</span>
<span class="n">request</span><span class="p">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'User-Agent'</span><span class="p">,</span> <span class="s">'Mozilla/5.0'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"D:/3.html"</span><span class="p">,</span><span class="s">'wb'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="9è®¾ç½®ä»£ç†æœåŠ¡å™¨">9.è®¾ç½®ä»£ç†æœåŠ¡å™¨</h3>
<p>a.ä½¿ç”¨  <code class="language-plaintext highlighter-rouge">urllib.request.ProxyHandler({'http':Proxy_addr})</code>
è®¾ç½®ä»£ç†æœåŠ¡å™¨ä¿¡æ¯ï¼Œå…¶ä¸­Proxy_addrä¸ºâ€œç½‘å€ï¼šç«¯å£å·â€ï¼›</p>

<p>b.åˆ›å»ºä¸€ä¸ªopenerå¯¹è±¡ï¼Œä»¥ä»£ç†æœåŠ¡å™¨ä¿¡æ¯å’Œurllib.request.HTTPHandlerä¸ºå‚æ•° ï¼›</p>

<p>c.åˆ›å»ºå…¨å±€é»˜è®¤çš„openerå¯¹è±¡ï¼›</p>

<p>d.åç»­æ“ä½œï¼›</p>

<p>ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>
 
<span class="n">proxy</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="s">'http'</span><span class="p">:</span><span class="s">'116.55.77.81:61201'</span><span class="p">})</span>  <span class="c1">#a
</span><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">HTTPHandler</span><span class="p">)</span>  <span class="c1">#b
</span><span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">install_opener</span><span class="p">(</span> <span class="n">opener</span><span class="p">)</span>  <span class="c1">#c
</span><span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">).</span><span class="n">read</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>  <span class="c1">#d
</span></code></pre></div></div>

<h3 id="10urlerror">10.URLError</h3>
<p>è¿™é‡Œä¸»è¦ä½¿ç”¨ä¸¤ä¸ªç±»ï¼šURLErrorç±» åŠå…¶å­ç±» HTTPErrorç±»</p>

<p>ä½¿ç”¨ä»£ç ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>
 
<span class="k">try</span><span class="p">:</span>
    <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div></div>

<p>äº§ç”ŸURLErrorçš„å¯èƒ½æœ‰ï¼š</p>

<p>a.è¿ä¸ä¸ŠæœåŠ¡å™¨;</p>

<p>b.è¿œç¨‹URLä¸å­˜åœ¨;</p>

<p>c.æ— ç½‘ç»œ;</p>

<p>d.è§¦å‘ HTTPError</p>

<p>è‹¥äº§ç”Ÿ HTTPError å¯ç”¨ HTTPError æ›¿æ¢ except ä¸­çš„ URLErrorï¼Œä½†æ˜¯è¦æå‰è¿›è¡Œåˆ¤æ–­é”™è¯¯ç±»å‹ã€‚è‹¥è§¦å‘å‰ä¸‰ç§é”™è¯¯æ—¶ä½¿ç”¨ except urllib.error.HTTPError as e å°†ä¼šäº§ç”Ÿé”™è¯¯ï¼ŒåŸå› æ˜¯æ— æ³•æ‰“å° e.reasonã€‚å› æ­¤å¯ä»¥å°†ä»£ç å†™æˆï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>
 
<span class="k">try</span><span class="p">:</span>
    <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1">#å…ˆç”¨å­ç±»å¤„ç†ï¼Œè‹¥æ— æ³•å¤„ç†å†ä½¿ç”¨çˆ¶ç±»å¤„ç†
</span>    <span class="k">print</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="11ä½¿ç”¨cookie">11.ä½¿ç”¨Cookie</h3>
<p>è·å–Cookie</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib.request</span><span class="p">,</span> <span class="n">http</span><span class="p">.</span><span class="n">cookiejar</span>

<span class="n">cookie</span> <span class="o">=</span> <span class="n">cookiejar</span><span class="p">.</span><span class="n">CookieJar</span><span class="p">()</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'http://www.baidu.com'</span><span class="p">)</span>
</code></pre></div></div>

<p>ä¿å­˜Cookieåˆ°æœ¬åœ°</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="s">'cookie.txt'</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">cookiejar</span><span class="p">.</span><span class="n">MozillaCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="c1">#æ­¤å¤„å°†CookieJaræ›¿æ¢ä¸ºMozillaCookieJar
</span><span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">"http://www.baidu.com"</span><span class="p">)</span>
<span class="n">cookie</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>è¯»å–æœ¬åœ°Cookie</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cookie</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">cookiejar</span><span class="p">.</span><span class="n">MozillaCookieJar</span><span class="p">()</span>
<span class="n">cookie</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">'cookie.txt'</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'http://www.baidu.com'</span><span class="p">)</span>
</code></pre></div></div>
:ET